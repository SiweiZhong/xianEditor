{"version":3,"file":"bundle.js","sources":["../node_modules/_lodash-es@4.17.4@lodash-es/_freeGlobal.js","../node_modules/_lodash-es@4.17.4@lodash-es/_root.js","../node_modules/_lodash-es@4.17.4@lodash-es/_Symbol.js","../node_modules/_lodash-es@4.17.4@lodash-es/_getRawTag.js","../node_modules/_lodash-es@4.17.4@lodash-es/_objectToString.js","../node_modules/_lodash-es@4.17.4@lodash-es/_baseGetTag.js","../node_modules/_lodash-es@4.17.4@lodash-es/_overArg.js","../node_modules/_lodash-es@4.17.4@lodash-es/_getPrototype.js","../node_modules/_lodash-es@4.17.4@lodash-es/isObjectLike.js","../node_modules/_lodash-es@4.17.4@lodash-es/isPlainObject.js","../node_modules/_symbol-observable@1.0.4@symbol-observable/lib/ponyfill.js","../node_modules/_symbol-observable@1.0.4@symbol-observable/lib/index.js","../node_modules/_symbol-observable@1.0.4@symbol-observable/index.js","../node_modules/_redux@3.7.1@redux/es/createStore.js","../node_modules/_redux@3.7.1@redux/es/utils/warning.js","../node_modules/_redux@3.7.1@redux/es/compose.js","../node_modules/_redux@3.7.1@redux/es/index.js","../src/constants/inputConstant.js","../src/constants/stateConstant.js","../src/util/index.js","../src/nodeStyle/index.js","../src/util/nodeTypes.js","../src/reducers/inputReducer.js","../src/reducers/stateReducer.js","../src/reducers/index.js","../src/Preview.vue","../src/actions/inputAction.js","../src/actions/stateAction.js","../src/controllers/public.js","../src/controllers/set.js","../src/controllers/move.js","../src/controllers/delete.js","../src/App.vue"],"sourcesContent":["/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport getPrototype from './_getPrototype.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) || baseGetTag(value) != objectTag) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return typeof Ctor == 'function' && Ctor instanceof Ctor &&\n    funcToString.call(Ctor) == objectCtorString;\n}\n\nexport default isPlainObject;\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports['default'] = symbolObservablePonyfill;\nfunction symbolObservablePonyfill(root) {\n\tvar result;\n\tvar _Symbol = root.Symbol;\n\n\tif (typeof _Symbol === 'function') {\n\t\tif (_Symbol.observable) {\n\t\t\tresult = _Symbol.observable;\n\t\t} else {\n\t\t\tresult = _Symbol('observable');\n\t\t\t_Symbol.observable = result;\n\t\t}\n\t} else {\n\t\tresult = '@@observable';\n\t}\n\n\treturn result;\n};","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _ponyfill = require('./ponyfill');\n\nvar _ponyfill2 = _interopRequireDefault(_ponyfill);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nvar root; /* global window */\n\n\nif (typeof self !== 'undefined') {\n  root = self;\n} else if (typeof window !== 'undefined') {\n  root = window;\n} else if (typeof global !== 'undefined') {\n  root = global;\n} else if (typeof module !== 'undefined') {\n  root = module;\n} else {\n  root = Function('return this')();\n}\n\nvar result = (0, _ponyfill2['default'])(root);\nexports['default'] = result;","module.exports = require('./lib/index');\n","import isPlainObject from 'lodash-es/isPlainObject';\nimport $$observable from 'symbol-observable';\n\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\nexport var ActionTypes = {\n  INIT: '@@redux/INIT'\n\n  /**\n   * Creates a Redux store that holds the state tree.\n   * The only way to change the data in the store is to call `dispatch()` on it.\n   *\n   * There should only be a single store in your app. To specify how different\n   * parts of the state tree respond to actions, you may combine several reducers\n   * into a single reducer function by using `combineReducers`.\n   *\n   * @param {Function} reducer A function that returns the next state tree, given\n   * the current state tree and the action to handle.\n   *\n   * @param {any} [preloadedState] The initial state. You may optionally specify it\n   * to hydrate the state from the server in universal apps, or to restore a\n   * previously serialized user session.\n   * If you use `combineReducers` to produce the root reducer function, this must be\n   * an object with the same shape as `combineReducers` keys.\n   *\n   * @param {Function} [enhancer] The store enhancer. You may optionally specify it\n   * to enhance the store with third-party capabilities such as middleware,\n   * time travel, persistence, etc. The only store enhancer that ships with Redux\n   * is `applyMiddleware()`.\n   *\n   * @returns {Store} A Redux store that lets you read the state, dispatch actions\n   * and subscribe to changes.\n   */\n};export default function createStore(reducer, preloadedState, enhancer) {\n  var _ref2;\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n    enhancer = preloadedState;\n    preloadedState = undefined;\n  }\n\n  if (typeof enhancer !== 'undefined') {\n    if (typeof enhancer !== 'function') {\n      throw new Error('Expected the enhancer to be a function.');\n    }\n\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  if (typeof reducer !== 'function') {\n    throw new Error('Expected the reducer to be a function.');\n  }\n\n  var currentReducer = reducer;\n  var currentState = preloadedState;\n  var currentListeners = [];\n  var nextListeners = currentListeners;\n  var isDispatching = false;\n\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice();\n    }\n  }\n\n  /**\n   * Reads the state tree managed by the store.\n   *\n   * @returns {any} The current state tree of your application.\n   */\n  function getState() {\n    return currentState;\n  }\n\n  /**\n   * Adds a change listener. It will be called any time an action is dispatched,\n   * and some part of the state tree may potentially have changed. You may then\n   * call `getState()` to read the current state tree inside the callback.\n   *\n   * You may call `dispatch()` from a change listener, with the following\n   * caveats:\n   *\n   * 1. The subscriptions are snapshotted just before every `dispatch()` call.\n   * If you subscribe or unsubscribe while the listeners are being invoked, this\n   * will not have any effect on the `dispatch()` that is currently in progress.\n   * However, the next `dispatch()` call, whether nested or not, will use a more\n   * recent snapshot of the subscription list.\n   *\n   * 2. The listener should not expect to see all state changes, as the state\n   * might have been updated multiple times during a nested `dispatch()` before\n   * the listener is called. It is, however, guaranteed that all subscribers\n   * registered before the `dispatch()` started will be called with the latest\n   * state by the time it exits.\n   *\n   * @param {Function} listener A callback to be invoked on every dispatch.\n   * @returns {Function} A function to remove this change listener.\n   */\n  function subscribe(listener) {\n    if (typeof listener !== 'function') {\n      throw new Error('Expected listener to be a function.');\n    }\n\n    var isSubscribed = true;\n\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      isSubscribed = false;\n\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n    };\n  }\n\n  /**\n   * Dispatches an action. It is the only way to trigger a state change.\n   *\n   * The `reducer` function, used to create the store, will be called with the\n   * current state tree and the given `action`. Its return value will\n   * be considered the **next** state of the tree, and the change listeners\n   * will be notified.\n   *\n   * The base implementation only supports plain object actions. If you want to\n   * dispatch a Promise, an Observable, a thunk, or something else, you need to\n   * wrap your store creating function into the corresponding middleware. For\n   * example, see the documentation for the `redux-thunk` package. Even the\n   * middleware will eventually dispatch plain object actions using this method.\n   *\n   * @param {Object} action A plain object representing “what changed”. It is\n   * a good idea to keep actions serializable so you can record and replay user\n   * sessions, or use the time travelling `redux-devtools`. An action must have\n   * a `type` property which may not be `undefined`. It is a good idea to use\n   * string constants for action types.\n   *\n   * @returns {Object} For convenience, the same action object you dispatched.\n   *\n   * Note that, if you use a custom middleware, it may wrap `dispatch()` to\n   * return something else (for example, a Promise you can await).\n   */\n  function dispatch(action) {\n    if (!isPlainObject(action)) {\n      throw new Error('Actions must be plain objects. ' + 'Use custom middleware for async actions.');\n    }\n\n    if (typeof action.type === 'undefined') {\n      throw new Error('Actions may not have an undefined \"type\" property. ' + 'Have you misspelled a constant?');\n    }\n\n    if (isDispatching) {\n      throw new Error('Reducers may not dispatch actions.');\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n\n    var listeners = currentListeners = nextListeners;\n    for (var i = 0; i < listeners.length; i++) {\n      var listener = listeners[i];\n      listener();\n    }\n\n    return action;\n  }\n\n  /**\n   * Replaces the reducer currently used by the store to calculate the state.\n   *\n   * You might need this if your app implements code splitting and you want to\n   * load some of the reducers dynamically. You might also need this if you\n   * implement a hot reloading mechanism for Redux.\n   *\n   * @param {Function} nextReducer The reducer for the store to use instead.\n   * @returns {void}\n   */\n  function replaceReducer(nextReducer) {\n    if (typeof nextReducer !== 'function') {\n      throw new Error('Expected the nextReducer to be a function.');\n    }\n\n    currentReducer = nextReducer;\n    dispatch({ type: ActionTypes.INIT });\n  }\n\n  /**\n   * Interoperability point for observable/reactive libraries.\n   * @returns {observable} A minimal observable of state changes.\n   * For more information, see the observable proposal:\n   * https://github.com/tc39/proposal-observable\n   */\n  function observable() {\n    var _ref;\n\n    var outerSubscribe = subscribe;\n    return _ref = {\n      /**\n       * The minimal observable subscription method.\n       * @param {Object} observer Any object that can be used as an observer.\n       * The observer object should have a `next` method.\n       * @returns {subscription} An object with an `unsubscribe` method that can\n       * be used to unsubscribe the observable from the store, and prevent further\n       * emission of values from the observable.\n       */\n      subscribe: function subscribe(observer) {\n        if (typeof observer !== 'object') {\n          throw new TypeError('Expected the observer to be an object.');\n        }\n\n        function observeState() {\n          if (observer.next) {\n            observer.next(getState());\n          }\n        }\n\n        observeState();\n        var unsubscribe = outerSubscribe(observeState);\n        return { unsubscribe: unsubscribe };\n      }\n    }, _ref[$$observable] = function () {\n      return this;\n    }, _ref;\n  }\n\n  // When a store is created, an \"INIT\" action is dispatched so that every\n  // reducer returns their initial state. This effectively populates\n  // the initial state tree.\n  dispatch({ type: ActionTypes.INIT });\n\n  return _ref2 = {\n    dispatch: dispatch,\n    subscribe: subscribe,\n    getState: getState,\n    replaceReducer: replaceReducer\n  }, _ref2[$$observable] = observable, _ref2;\n}","/**\n * Prints a warning in the console if it exists.\n *\n * @param {String} message The warning message.\n * @returns {void}\n */\nexport default function warning(message) {\n  /* eslint-disable no-console */\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    console.error(message);\n  }\n  /* eslint-enable no-console */\n  try {\n    // This error was thrown as a convenience so that if you enable\n    // \"break on all exceptions\" in your console,\n    // it would pause the execution at this line.\n    throw new Error(message);\n    /* eslint-disable no-empty */\n  } catch (e) {}\n  /* eslint-enable no-empty */\n}","/**\n * Composes single-argument functions from right to left. The rightmost\n * function can take multiple arguments as it provides the signature for\n * the resulting composite function.\n *\n * @param {...Function} funcs The functions to compose.\n * @returns {Function} A function obtained by composing the argument functions\n * from right to left. For example, compose(f, g, h) is identical to doing\n * (...args) => f(g(h(...args))).\n */\n\nexport default function compose() {\n  for (var _len = arguments.length, funcs = Array(_len), _key = 0; _key < _len; _key++) {\n    funcs[_key] = arguments[_key];\n  }\n\n  if (funcs.length === 0) {\n    return function (arg) {\n      return arg;\n    };\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0];\n  }\n\n  return funcs.reduce(function (a, b) {\n    return function () {\n      return a(b.apply(undefined, arguments));\n    };\n  });\n}","import createStore from './createStore';\nimport combineReducers from './combineReducers';\nimport bindActionCreators from './bindActionCreators';\nimport applyMiddleware from './applyMiddleware';\nimport compose from './compose';\nimport warning from './utils/warning';\n\n/*\n* This is a dummy function to check if the function name has been altered by minification.\n* If the function has been minified and NODE_ENV !== 'production', warn the user.\n*/\nfunction isCrushed() {}\n\nif (process.env.NODE_ENV !== 'production' && typeof isCrushed.name === 'string' && isCrushed.name !== 'isCrushed') {\n  warning('You are currently using minified code outside of NODE_ENV === \\'production\\'. ' + 'This means that you are running a slower development build of Redux. ' + 'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify ' + 'or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) ' + 'to ensure you have the correct code for your production build.');\n}\n\nexport { createStore, combineReducers, bindActionCreators, applyMiddleware, compose };","export const ADD_KEY = 'ADD_KEY'\r\nexport const BACKSPACE = 'BACKSPACE'\r\n\r\nexport const ADD_ROW = 'ADD_ROW'\r\n\r\nexport const ADD_B = 'ADD_B'\r\n","export const SET_LOCATION = 'SET_LOCATION'\r\nexport const SET_ORIGIN = 'SET_ORIGIN'\r\n\r\nexport const MOVE_LEFT = 'MOVE_LEFT'\r\nexport const MOVE_RIGHT = 'MOVE_RIGHT'\r\nexport const MOVE_UP = 'MOVE_UP'\r\nexport const MOVE_DOWN = 'MOVE_DOWN'\r\nexport const SET_ROWS_INDEX = 'SET_ROWS_INDEX'\r\nexport const S_C_A_KEY = 'S_C_A_KEY'  //shift ctrl alt\r\n\r\nexport const SET_WIDTH = 'SET_WIDTH';\r\nexport const SET_HEIGHT = 'SET_HEIGHT';\r\n\r\nexport const AUTO_LINEFEED = 'AUTO_LINEFEED';","import * as nodeTypes from './nodeTypes'\r\n\r\nfunction whereAmI(words, location){\r\n  let x = 0;\r\n  let loc = location;\r\n\r\n  if(words.length == 0){\r\n    return {x:0, y:0};\r\n  }else if(loc == words.length){ // 光标在结尾处时\r\n    loc--;\r\n    x++;\r\n    if(words[loc] instanceof nodeTypes.Enter){\r\n      return {x:0, y:words[loc].rowNum+1};\r\n    }\r\n  }\r\n\r\n  const word = words[loc];\r\n  const y = word.rowNum;\r\n  for(let i=loc;i>=0;i--){\r\n    const w = words[i];\r\n    if(w.rowNum == word.rowNum){\r\n      x++;\r\n    }else{\r\n      break;\r\n    }\r\n  }\r\n  x--;\r\n\r\n  return {x, y};\r\n}\r\n\r\nconst canvas = document.createElement('canvas');\r\nconst ctx = canvas.getContext('2d');\r\n\r\nconst fontSize = '16px';\r\nconst fontWeight = 'normal';\r\nconst fontFamily = 'Microsoft YaHei';\r\n\r\nctx.font = `${fontSize} ${fontWeight} ${fontFamily}`;\r\n\r\nfunction getFontWidth(text='', size=fontSize, weight=fontWeight, family=fontFamily){\r\n  ctx.save();\r\n  ctx.font = `${size} ${weight} ${family}`;\r\n  let w = ctx.measureText(text).width;\r\n  ctx.restore();\r\n  return w;\r\n}\r\n\r\nfunction setData(self, state){\r\n  self.state = state.editorState;\r\n  self.words = state.words;\r\n}\r\n\r\nfunction stringify(styleObject){\r\n  let str = '';\r\n  Object.keys(styleObject).forEach(key => {\r\n    str += `${key}:${styleObject[key]};`;\r\n  });\r\n  return str;\r\n}\r\n\r\nexport {nodeTypes, whereAmI, setData, getFontWidth, updateWordsProps, stringify}","export const mathTag = {\r\n  display: 'inline-block',\r\n  color: '#595959',\r\n  background: '#cecece',\r\n  'border-radius': '0.2em',\r\n  'text-align': 'center',\r\n}","import {getFontWidth} from './index'\r\nimport * as nodeStyle from '../nodeStyle'\r\n\r\nclass Identifier {\r\n  constructor (){\r\n    \r\n  }\r\n  createEndIdentifier (...arg){\r\n    const ident = new this.constructor(...arg);\r\n    ident.header = this;\r\n    this.end = ident;\r\n    return ident;\r\n  }\r\n}\r\nclass Style extends Identifier {\r\n  constructor (style={}){\r\n    super();\r\n    this.name = 'span';\r\n    this.style = style;\r\n    this.init()\r\n  }\r\n  init (){\r\n    this.width = this.style.width || 0;\r\n  }\r\n  replace (width){\r\n    this.width = width;\r\n  }\r\n}\r\n\r\nclass Placeholder extends Identifier {\r\n  constructor (name, attrs={}, style={}, value){\r\n    super();\r\n    \r\n    this.name = name;\r\n    this.attrs = attrs;\r\n    this.style = style;\r\n    this.value = value;\r\n    \r\n    this.init();\r\n  }\r\n  init (){\r\n    const {width, height} = this.style;\r\n    this.width = 0;\r\n    this.height = 0;\r\n    if(width){\r\n      this.width = +width.match(/\\d+/)[0] || 0;\r\n    }\r\n    if(height){\r\n      this.height = +height.match(/\\d+/)[0] || 0;\r\n    }\r\n    this._w = this.width;\r\n    this._h = this.height;\r\n  }\r\n  replace (width){\r\n    this.width = width;\r\n  }\r\n}\r\n\r\nclass Text extends Placeholder {\r\n  constructor (value){\r\n    super();\r\n    this.name = 'span';\r\n    this.value = value;\r\n    this.real = value;\r\n    this.width = 0;\r\n  }\r\n  setWidth (){\r\n    \r\n  }\r\n}\r\n\r\nclass Space extends Text {\r\n  constructor (){\r\n    super();\r\n\r\n    this.value = '&nbsp';\r\n    this.real = '\\x20';\r\n  }\r\n}\r\n\r\nclass Tab extends Text {\r\n  constructor (){\r\n    super();\r\n    \r\n    this.value = '&nbsp&nbsp&nbsp&nbsp';\r\n    this.real = '\\x20\\x20\\x20\\x20';\r\n  }\r\n}\r\n\r\nclass Enter extends Text {\r\n  constructor (){\r\n    super();\r\n    this.name = 'br';\r\n    this.value = '<br>';\r\n    this.real = '\\n';\r\n  }\r\n}\r\n\r\nclass Group extends Identifier {\r\n  constructor (style={}){\r\n    super();\r\n    this.name = 'div';\r\n    this.style = style;\r\n    this.init()\r\n  }\r\n  init (){\r\n    this.width = this.style.width || 0;\r\n  }\r\n  replace (width){\r\n    this.width = width;\r\n  }\r\n}\r\n\r\nclass MathTag extends Group {\r\n  constructor (attrs={}){\r\n    super();\r\n    this.name = 'span';\r\n    this.attrs = attrs;\r\n    this.style = Object.assign({}, nodeStyle.mathTag);\r\n\r\n    this.init()\r\n  }\r\n  // init (){\r\n\r\n  // }\r\n}\r\n\r\n\r\nexport {Identifier, Style, Group, Placeholder, MathTag, Text, Space, Tab, Enter}","import * as constants from '../constants'\r\nimport {Identifier, Style, Placeholder, MathTag, Text, Space, Tab, Enter} from '../util/nodeTypes'\r\n\r\nexport function words(state=[], action, editorState){\r\n  const {location, origin} = editorState;\r\n  switch(action.type){\r\n  case constants.ADD_KEY:\r\n    state = [...state];\r\n    state.splice(location, 0, action.value);\r\n    return state\r\n\r\n  case constants.BACKSPACE: {\r\n    state = [...state];\r\n    state.splice(location, 1);\r\n    return state;\r\n  }\r\n\r\n  case constants.ADD_B: {\r\n    let a = origin, b = location;\r\n    if(a == b) return state;\r\n\r\n    if(a > b){\r\n      let c = b;\r\n      b = a;\r\n      a = c;\r\n    }\r\n    state = [...state];\r\n    \r\n    const w = new Style({'font-weight': 'bold'});\r\n    state.splice(a, 0, w);\r\n    state.splice(b+1, 0, w.createEndIdentifier());\r\n    \r\n    return state;\r\n  }\r\n\r\n  default:\r\n    return state\r\n  }\r\n}","import * as constants from '../constants'\r\n\r\nconst initEditorState = {\r\n  location: 0,\r\n  origin: 0,\r\n  rowsIndex: [],\r\n  shiftKey: false,\r\n  ctrlKey: false,\r\n  altKey: false,\r\n  autoLinefeed: true,\r\n}\r\nexport function editorState(state=initEditorState, action){\r\n  switch(action.type){\r\n\r\n    case constants.SET_LOCATION:\r\n      return Object.assign({}, state, {\r\n        location: action.value\r\n      })\r\n\r\n    case constants.SET_ORIGIN:\r\n      return Object.assign({}, state, {\r\n        origin: action.value\r\n      })\r\n\r\n    case constants.S_C_A_KEY: {\r\n      const {shiftKey, ctrlKey, altKey} = action.value;\r\n      return Object.assign({}, state, {\r\n        shiftKey, ctrlKey, altKey\r\n      })\r\n    }\r\n\r\n    case constants.SET_WIDTH:\r\n      return Object.assign({}, state, {\r\n        width: action.value\r\n      })\r\n\r\n    case constants.SET_HEIGHT:\r\n      return Object.assign({}, state, {\r\n        height: action.value\r\n      })\r\n\r\n    case constants.AUTO_LINEFEED:\r\n      return Object.assign({}, state, {\r\n        autoLinefeed: action.value\r\n      })\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}","import {combineReducers, createStore} from 'redux'\r\n\r\nimport {words} from './inputReducer'\r\nimport {editorState} from './stateReducer'\r\n\r\nfunction app(state={}, action){\r\n  const _editorState = editorState(state.editorState, action)\r\n\r\n  return {\r\n    editorState: _editorState,\r\n    words : words(state.words, action, _editorState),\r\n  }\r\n}\r\n\r\nexport default createStore(app)","<template> \r\n  <div class=\"icons\">\r\n    <span class=\"icon\" @click=\"clickingBold\">B</span>\r\n    <!--<span class=\"icon\" @click=\"clickingAutoLinefeed\">Linefeed</span>-->\r\n    <span class=\"icon\" @click=\"clickingMath\">Math</span>\r\n  </div>\r\n</template>\r\n<script>\r\nimport store from './reducers'\r\nexport default {\r\n  data (){\r\n    return{\r\n      autoLinefeed: false,\r\n    }\r\n  },\r\n  methods: {\r\n    clickingBold (event){\r\n      this.$emit('clickingTools', 'bold');\r\n    },\r\n    clickingAutoLinefeed (event){\r\n      this.$emit('clickingTools', 'autoLinefeed', this.autoLinefeed);\r\n      this.autoLinefeed = !this.autoLinefeed;\r\n    },\r\n    clickingMath (event){\r\n      this.$emit('clickingTools', 'math');\r\n    },\r\n  },\r\n}\r\n</script>\r\n<style scoped>\r\n.icons * {\r\n  box-sizing: border-box;\r\n}\r\n.icons {\r\n  border: 1px solid var(--border-color);\r\n  border-bottom-width: 0px;\r\n  background: #f3f3f3;\r\n}\r\n.icon {\r\n  line-height: 1.6em;\r\n  min-width: 1.42em;\r\n  text-align: center;\r\n  user-select: none;\r\n  display: inline-block;\r\n  box-sizing: border-box;\r\n\r\n  margin-right: 4px;\r\n  cursor: pointer;\r\n}\r\n</style>","import * as constants from '../constants'\r\nfunction addKey(word){\r\n  return {type: constants.ADD_KEY, value: word}\r\n}\r\nfunction backspace(){\r\n  return {type: constants.BACKSPACE}\r\n}\r\nfunction addB(){\r\n  return {type: constants.ADD_B}\r\n}\r\nexport {addKey, backspace, addB}\r\n","import * as constants from '../constants'\r\nfunction moveLeft(span=1){\r\n  return {type: constants.MOVE_LEFT, span}\r\n}\r\nfunction moveRight(span=1){\r\n  return {type: constants.MOVE_RIGHT, span}\r\n}\r\nfunction moveUp(span=1){\r\n  return {type: constants.MOVE_UP, span}\r\n}\r\nfunction moveDown(span=1){\r\n  return {type: constants.MOVE_DOWN, span}\r\n}\r\nfunction setLocation (location){\r\n  return {type: constants.SET_LOCATION, value: location}\r\n}\r\nfunction setOrigin (location){\r\n  return {type: constants.SET_ORIGIN, value: location}\r\n}\r\nfunction scaKey (shiftKey, ctrlKey, altKey){\r\n  return {type: constants.S_C_A_KEY, value: {shiftKey, ctrlKey, altKey}}\r\n}\r\nfunction setWidth (width){\r\n  return {type: constants.SET_WIDTH, value: width}\r\n}\r\nfunction setHeight (height){\r\n  return {type: constants.SET_HEIGHT, value: height}\r\n}\r\nfunction setAutoLinefeed (v){\r\n  return {type: constants.AUTO_LINEFEED, value: v}\r\n}\r\nexport {moveLeft, moveRight, moveUp, moveDown, setLocation, setOrigin, removeRowsIndex, scaKey, setWidth, setHeight, setAutoLinefeed}","import store from '../reducers'\r\nimport {nodeTypes, getFontWidth} from '../util/'\r\n\r\nconst {Identifier, Style, Placeholder, MathTag, Text, Space, Tab, Enter} = nodeTypes\r\n\r\nlet tree = {};\r\n\r\nconst unsubscribe = store.subscribe(()=>{\r\n  tree = store.getState();\r\n})\r\n\r\nexport function updateWordsProps (location){\r\n  // let {location} = tree.editorState;\r\n  if(tree.words.length == 0){\r\n    return;\r\n  }\r\n  \r\n  while(location <= tree.words.length){\r\n    let loc = location\r\n    let word = tree.words[--loc];\r\n    \r\n    if(!word){\r\n      location++;\r\n      continue;\r\n    }\r\n\r\n    let rowNum;\r\n    let text = word.real || '';\r\n    let width = word._w || 0;\r\n\r\n    while(loc > 0){\r\n      let last = tree.words[--loc];\r\n      if(last instanceof Style){\r\n        continue;\r\n      }\r\n      if(rowNum == undefined){\r\n        rowNum = last.rowNum;\r\n      }\r\n      if(last.rowNum != rowNum){\r\n        break;\r\n      }\r\n      if(last instanceof Enter){\r\n        rowNum++;\r\n        break\r\n      }\r\n      text += last.real || '';\r\n      width += last._w || 0;\r\n\r\n      if(loc < 0) break;\r\n    }\r\n    word.rowNum = rowNum || 0;\r\n    \r\n    width += getFontWidth(text);\r\n    if(tree.words[location-2] instanceof Enter){ \r\n      width = getFontWidth(word.real);\r\n    }else if(tree.editorState.autoLinefeed && width > tree.editorState.width){\r\n      width = getFontWidth(word.real);\r\n      word.rowNum++;\r\n    }\r\n    word.width = width;\r\n\r\n    location++;\r\n  }\r\n}","import store from '../reducers'\r\n\r\nimport {getFontWidth} from '../util'\r\nimport {updateWordsProps} from './public'\r\n\r\nimport {addKey, setLocation, setOrigin} from '../actions'\r\nimport {Identifier, Style, Placeholder, MathTag, Text, Space, Tab, Enter} from '../util/nodeTypes'\r\n\r\nlet tree = {};\r\n\r\nconst unsubscribe = store.subscribe(()=>{\r\n  tree = store.getState();\r\n})\r\n\r\nexport function addWord (key){\r\n  let word;\r\n  if(key == ' '){\r\n    word = new Space()\r\n  }else if(key == 'Tab'){\r\n    word = new Tab()\r\n  }else{\r\n    word = new Text(key)\r\n  }\r\n  store.dispatch(addKey(word));\r\n  store.dispatch(setLocation(tree.editorState.location+1));\r\n  store.dispatch(setOrigin(tree.editorState.location));\r\n  \r\n  updateWordsProps(tree.editorState.location);\r\n}\r\n\r\nexport function addPlaceholder (node){\r\n  store.dispatch(addKey(node));\r\n  store.dispatch(setLocation(tree.editorState.location+1));\r\n  store.dispatch(setOrigin(tree.editorState.location));\r\n\r\n  updateWordsProps(tree.editorState.location);\r\n}\r\n\r\nexport function addMath (){\r\n  const start = new MathTag({class:\"math_tag\"});\r\n  \r\n  store.dispatch(addKey(new Text('$')));\r\n  store.dispatch(addKey(start));\r\n  \r\n  store.dispatch(setLocation(tree.editorState.location+2));\r\n  store.dispatch(addKey(start.createEndIdentifier()));\r\n  store.dispatch(addKey(new Text('$')));\r\n  \r\n  store.dispatch(setOrigin(tree.editorState.location));\r\n\r\n  updateWordsProps(tree.editorState.location-2);\r\n}\r\n\r\nexport function addEnter (){\r\n  const word = new Enter();\r\n\r\n  store.dispatch(addKey(word));\r\n  store.dispatch(setLocation(tree.editorState.location+1));\r\n  store.dispatch(setOrigin(tree.editorState.location));\r\n  updateWordsProps(tree.editorState.location);\r\n}","import store from '../reducers'\r\nimport {setLocation, setOrigin} from '../actions'\r\nimport {whereAmI, nodeTypes} from '../util/'\r\n\r\nconst {Identifier, Style, Placeholder, MathTag, Text, Space, Tab, Enter} = nodeTypes;\r\n\r\nlet tree = {};\r\n\r\nconst unsubscribe = store.subscribe(()=>{\r\n  tree = store.getState();\r\n})\r\n\r\n\r\nexport function moveUp(){\r\n  if(tree.words.length == 0) return;\r\n\r\n  let {x, y} = whereAmI(tree.words, tree.editorState.location);//x y是下标从零计数\r\n  \r\n  let loc = tree.editorState.location;\r\n  let n = 0;\r\n  let i = loc > 0 ? loc-1 : 0;\r\n  for(;i>=0;i--){\r\n    if(tree.words[i] instanceof Style){\r\n      loc--;\r\n      continue;\r\n    }\r\n    if(tree.words[i].rowNum < y-1){\r\n      break;\r\n    }\r\n\r\n    loc--;\r\n    if(tree.words[i].rowNum == y-1){\r\n      n++;\r\n    }\r\n    \r\n  }\r\n  loc += n > x ? x : n-1;\r\n  loc = loc < 0 ? 0 : loc;\r\n\r\n  store.dispatch(setLocation(loc));\r\n  if(!tree.editorState.shiftKey){\r\n    store.dispatch(setOrigin(tree.editorState.location));\r\n  }\r\n}\r\nexport function moveDown(){\r\n  if(tree.words.length == 0) return;\r\n\r\n  let {x, y} = whereAmI(tree.words, tree.editorState.location);\r\n\r\n  let loc = tree.editorState.location;\r\n  let n = 0;\r\n\r\n  const length = tree.words.length;\r\n  let i = loc == length-1 ? length : loc;\r\n  for(;i<length;i++){\r\n    if(tree.words[i] instanceof Style){\r\n      loc++;\r\n      continue;\r\n    }\r\n    if(tree.words[i].rowNum > y+1){\r\n      break;\r\n    }\r\n\r\n    if(tree.words[i].rowNum == y+1){\r\n      if(n == x){\r\n        break;\r\n      }\r\n      n++;\r\n    }\r\n    loc++;\r\n  }\r\n  store.dispatch(setLocation(loc));\r\n\r\n  if(!tree.editorState.shiftKey){\r\n    store.dispatch(setOrigin(tree.editorState.location));\r\n  }\r\n}\r\nexport function moveLeft(){\r\n  while(tree.editorState.location > 0){\r\n    const x = tree.editorState.location-1;\r\n    const word = tree.words[x];\r\n\r\n    if(word instanceof Style){\r\n      store.dispatch(setLocation(x));\r\n    }else{\r\n      store.dispatch(setLocation(x));\r\n      if(!tree.editorState.shiftKey){\r\n        store.dispatch(setOrigin(tree.editorState.location));\r\n      }\r\n      break\r\n    }\r\n  }\r\n}\r\nexport function moveRight(){\r\n  while(tree.editorState.location < tree.words.length){\r\n    const x = tree.editorState.location + 1\r\n    let word = tree.words[x];\r\n    if(word instanceof Style){\r\n      store.dispatch(setLocation(x));\r\n    }else{\r\n      store.dispatch(setLocation(x));\r\n      if(!tree.editorState.shiftKey){\r\n        store.dispatch(setOrigin(tree.editorState.location));\r\n      }\r\n      break\r\n    }\r\n  }\r\n}","import store from '../reducers'\r\nimport {setLocation, setOrigin, backspace} from '../actions'\r\nimport {nodeTypes, getFontWidth} from '../util/'\r\nimport {updateWordsProps} from './public'\r\n\r\nconst {Identifier, Style, Group, Placeholder, MathTag, Text, Space, Tab, Enter} = nodeTypes;\r\n\r\nlet tree = {};\r\n\r\nconst unsubscribe = store.subscribe(()=>{\r\n  tree = store.getState();\r\n})\r\n\r\nexport function delBackspace(){\r\n  while(1){\r\n    let {location} = tree.editorState;\r\n    if(location <= 0) break;\r\n    let word = tree.words[location-1];\r\n    \r\n    if(word instanceof Placeholder){\r\n\r\n      store.dispatch(setLocation(location-1));\r\n      store.dispatch(backspace());\r\n    \r\n      const last = tree.words[tree.editorState.location-1];\r\n      if(!last){\r\n        break;\r\n      }\r\n      word = tree.words[tree.editorState.location];\r\n      if( (word instanceof Style || word instanceof Group) && word.header){ //遇到空的样式节点就删除\r\n        if(word.header === last){\r\n          store.dispatch(backspace());\r\n          store.dispatch(setLocation(tree.editorState.location-1));\r\n          store.dispatch(backspace());\r\n        }\r\n        if(tree.words[tree.editorState.location-1] instanceof Placeholder){\r\n          break;\r\n        }\r\n      }else{\r\n        break;\r\n      }\r\n    }else{\r\n      store.dispatch(setLocation(tree.editorState.location-1));\r\n    }\r\n  }\r\n  store.dispatch(setOrigin(tree.editorState.location));\r\n\r\n  updateWordsProps(tree.editorState.location)\r\n}","<script>\r\nimport store from './reducers'\r\n\r\nimport Preview from './Preview.vue'\r\n\r\nimport {nodeTypes, getFontWidth, whereAmI, setData, stringify} from './util'\r\nimport {addKey, addB, backspace, setLocation, setOrigin, scaKey, setWidth, setHeight, setAutoLinefeed} from './actions'\r\n\r\nimport {\r\n  addWord, addEnter, addPlaceholder, addMath,\r\n  moveUp, moveDown, moveLeft, moveRight,\r\n  delBackspace,\r\n} from './controllers'\r\n\r\nconst {Identifier, Style, Group, Placeholder, MathTag, Text, Space, Tab, Enter} = nodeTypes;\r\n\r\nfunction renderContent (h, i){\r\n  let _children = [];\r\n  for(;i<this._words.length;i++){\r\n    let w = this._words[i];\r\n    const len = _children.length;\r\n    if(w instanceof Style){\r\n      if(w.end){\r\n        const {children, index} = renderContent.call(this, h, i+1);\r\n        const attrs = {style: w.style};\r\n        _children[len] = h(w.name , attrs, children);\r\n        i = index;\r\n      }else{\r\n        return {children:_children, index: i};\r\n      }\r\n    }else if(w instanceof Group){\r\n      if(w.end){\r\n        const {children, index} = renderContent.call(this, h, i+1);\r\n        const attrs = {style: w.style};\r\n        _children[len] = h(w.name , attrs, children);\r\n        i = index;\r\n      }else{\r\n        return {children:_children, index: i};\r\n      }\r\n    }else if(w instanceof Placeholder){\r\n      if(w instanceof Text){\r\n        if(w.constructor.name == 'Text'){\r\n          _children[len] = w.value\r\n        }else{\r\n          _children[len] = h(w.name, {domProps:{innerHTML:w.value}});\r\n        }\r\n      }else{\r\n        const attrs = {attrs: w.attrs, style: w.style};\r\n        _children[len] = h(w.name, attrs, w.value);\r\n      }\r\n    }\r\n  }\r\n  return _children;\r\n}\r\n\r\nexport default {\r\n  name: 'editor',\r\n  props: ['width', 'height'],\r\n  data () {\r\n    return {\r\n      state: {},\r\n      words: [],\r\n      hheadAscent: 0, //文字渲染后行高与文字高度比\r\n      fontSize: 16,\r\n      head: 0,\r\n      autoLinefeed: true,\r\n      input: undefined,\r\n      isFocused: false,\r\n      isProcess: false,\r\n    }\r\n  },\r\n  computed: {\r\n    lineHeight (){\r\n      return this.fontSize * this.hheadAscent;\r\n    },\r\n    offsetY (){\r\n      const a = Math.floor(this.height / this.lineHeight);\r\n      const b = this.y();\r\n      const m = b - this.head;\r\n      if(m >= a){\r\n        this.head += m - a + 1;\r\n      }else if(m < 0){\r\n        this.head += m;\r\n      }\r\n      return -this.head * this.lineHeight;\r\n    },\r\n    _words (){\r\n      const {origin, location} = this.state\r\n\r\n      if(origin == location){\r\n        return this.words;\r\n      }\r\n      let words = this.words.slice();\r\n      \r\n      let a = origin, b = location;\r\n      if(a > b){\r\n        let c = b;\r\n        b = a;\r\n        a = c;\r\n      }\r\n      let arr = this.words.slice(a, b);\r\n      const start = new Style({\r\n        'line-height': this.lineHeight + 'px',\r\n        background: '#3390ff',\r\n      });\r\n\r\n      arr.unshift(start);\r\n      arr.push(start.createEndIdentifier());\r\n      words.splice(a, b-a, ...arr);\r\n      \r\n      return words;\r\n    }\r\n  },\r\n  methods: {\r\n    x (){ //Vue2取消了computed cache ,使用方法调用计算x y的值\r\n      let {location} = this.state;\r\n      const y = this.y();\r\n      let width = 0;\r\n      while(1){\r\n        if(location == 0){\r\n          break;\r\n        }\r\n        let word = this.words[--location];\r\n        if(word.rowNum == y){\r\n          if(!word.width) continue;\r\n          width = word.width;\r\n          break;\r\n        }\r\n      }\r\n      return width - 1;\r\n    },\r\n    y (){\r\n      const {words} = this;\r\n      let {location} = this.state;\r\n      let i = 0;\r\n      while(location >= 0){\r\n        if(location == 0 && !words[location]) { //没有任何输入时\r\n          return 0;\r\n        };\r\n        \r\n        let word = words[--location];\r\n        if(word instanceof Placeholder){\r\n          i = word.rowNum;\r\n          if(word instanceof Enter){ //光标左边是换行时y+1\r\n            i++\r\n          }else if(words[location+1]){\r\n            if(words[location+1].rowNum > word.rowNum){\r\n              i++\r\n            }\r\n          }\r\n          break;\r\n        }\r\n      }\r\n      return i;\r\n    },\r\n    \r\n    clickingTools (name, ...arg){\r\n      if(name == 'bold'){\r\n        if(this.state.location == this.state.origin){\r\n          return;\r\n        }\r\n        store.dispatch(addB());\r\n        \r\n        store.dispatch(setLocation(this.state.location+1));\r\n        store.dispatch(setOrigin(this.state.origin + 1));\r\n      }else if(name == 'math'){\r\n        addMath()\r\n      }\r\n    },\r\n    keydown (event){\r\n      let {key, code, shiftKey, ctrlKey, altKey, target} = event;\r\n      let {state, words} = this\r\n      let {location, rowsIndex} = state\r\n      if(key != 'Process'){\r\n        this.isProcess = false;\r\n        store.dispatch(scaKey(shiftKey, ctrlKey, altKey));\r\n\r\n        switch(code){\r\n          case 'ArrowUp': \r\n            moveUp();\r\n            break;\r\n          case 'ArrowDown':\r\n            moveDown();\r\n            break;\r\n          case 'ArrowLeft':\r\n            moveLeft();\r\n            break;\r\n          case 'ArrowRight':\r\n            moveRight();\r\n            break;\r\n          case 'Backspace':\r\n            delBackspace();\r\n            break;\r\n          case 'NumpadEnter': //Enter\r\n          case 'Enter': //Enter\r\n            addEnter(key)\r\n            break;\r\n          case 'ShiftLeft':\r\n          case 'ControlLeft':\r\n          case 'AltLeft':\r\n          case 'ShiftRight':\r\n          case 'ControlRight':\r\n          case 'AltRight':\r\n            break;\r\n          default:\r\n            addWord(key)\r\n        }\r\n        event.preventDefault();\r\n      }else{\r\n        this.isProcess = true;\r\n      }\r\n      // event.preventDefault();\r\n    },\r\n    oninput (event){\r\n      const {selectionStart, selectionEnd} = event.target\r\n      \r\n      if(this.isProcess && selectionStart == selectionEnd){\r\n        let text = [...event.target.innerHTML];\r\n        window.el = event.target\r\n        \r\n        text.forEach(s=>{\r\n          addWord(s);\r\n        })\r\n        this.isProcess = false;\r\n        // event.target.innerHTML = '';\r\n      }\r\n      \r\n    },\r\n    editorFocus (event){\r\n      this.$refs.back.focus();\r\n    },\r\n    submit (event){\r\n      const text = this.words\r\n        .map(w => {\r\n          if(w instanceof Placeholder){\r\n            return w.value\r\n          }else{\r\n            if(w.end){\r\n              // return `<span style=\"font-weight:bold\">`\r\n              if(w instanceof Style){\r\n                return `<${w.name} class=\"${w.attrs.class}\" style=\"${stringify(w.style)}\">`\r\n              }else if (w instanceof Group){\r\n                return `<${w.name} class=\"${w.attrs.class}\">`\r\n              }\r\n              \r\n            }else if(w.header){\r\n              return `</${w.name}>`\r\n            }\r\n          }\r\n        })\r\n        .join('');\r\n\r\n      this.$emit('submit-content', text);\r\n    }\r\n  },\r\n\r\n  created (){\r\n    const unsubscribe = store.subscribe(()=>{\r\n      setData(this, store.getState())\r\n    })\r\n    store.dispatch(setLocation(0));\r\n    store.dispatch(setWidth(this.width));\r\n    store.dispatch(setHeight(this.height));\r\n  },\r\n\r\n  mounted (){\r\n    const sp = document.createElement('span');\r\n    sp.style.fontSize = '1000px';\r\n    sp.style.visibility = 'hidden';\r\n    sp.style.position = 'absolute';\r\n    sp.style.top = '0px';\r\n    sp.style.left = '0px';\r\n    sp.innerHTML = 'a';\r\n    document.body.appendChild(sp);\r\n    \r\n    this.hheadAscent = sp.offsetHeight / 1000; // 获取真实行高比\r\n    \r\n  },\r\n  \r\n  render (h){\r\n    const data = renderContent.call(this, h, 0);\r\n    console.log(this._words.map(w => w.value ? w.value+'=>'+w.rowNum+'-'+w.width : undefined))\r\n    // console.log(this._words)\r\n    return (\r\n      <div class=\"xianEditor\" onClick={this.editorFocus}>\r\n        <Preview onClickingTools={this.clickingTools}></Preview>\r\n        <div class=\"wrap\" style={{'width': this.width+'px', 'height': this.height+'px'}} >\r\n          <textarea\r\n            ref=\"back\"\r\n            class=\"back\" contenteditable=\"true\"\r\n            onKeydown={this.keydown}\r\n            onInput={this.oninput}\r\n            onFocus = {()=>this.isFocused = true}\r\n            onBlur = {()=>this.isFocused = false}\r\n          >\r\n          </textarea>\r\n          <div class={[\"editor\", this.isFocused?'isFocused':'']}\r\n            style={{\r\n              'line-height': this.lineHeight + 'px',\r\n              '--x': this.x() + 'px', \r\n              '--y': this.y() * this.lineHeight + 'px',\r\n              'top': this.offsetY + 'px',\r\n              'word-break': this.autoLinefeed ? 'break-all' : 'normal',\r\n            }}>\r\n            {\r\n              data.length || this.isFocused ? \"\" : <span style={{color: '#ccc'}}>请输入内容...</span>\r\n            }\r\n            {\r\n              data\r\n            }\r\n          </div>\r\n        </div>\r\n        <button onClick={this.submit}>预览</button>\r\n      </div>\r\n    )\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.xianEditor > *{\r\n  box-sizing: border-box;\r\n}\r\n.xianEditor{\r\n  font-family: 'Microsoft YaHei';\r\n  font-size: 16px;\r\n  text-align: left;\r\n\r\n  display: inline-block;\r\n  position: relative;\r\n\r\n  --border-color: #cfcfcf;\r\n}\r\n.wrap{\r\n  border: 1px solid var(--border-color);\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n.editor{\r\n  position: relative;\r\n  min-height: 100%;\r\n  background: #fff;\r\n  pointer-events: none;\r\n}\r\n.isFocused::before{\r\n  content: '|';\r\n  position: absolute;\r\n  top: var(--y);\r\n  left: var(--x);\r\n  animation-duration: 1.2s;\r\n  animation-iteration-count: infinite;\r\n  animation-name: slidein;\r\n}\r\n.back{\r\n  width: 100%;\r\n  height: 100%;\r\n  position: absolute;\r\n  top: 0px;\r\n  left: 0px;\r\n}\r\n.placeholder{\r\n  display: inline-block;\r\n  text-align: center;\r\n}\r\n.math_tag{\r\n  color: #595959;\r\n  background: #cecece;\r\n  border-radius: 0.2em;\r\n}\r\n\r\n@keyframes slidein {\r\n  0%{\r\n    opacity: 1;\r\n  }\r\n  49%{\r\n    opacity: 1;\r\n  }\r\n  50%{\r\n    opacity: 0;\r\n  }\r\n  100%{\r\n    opacity: 0;\r\n  }\r\n}\r\n</style>"],"names":["Symbol","objectProto","hasOwnProperty","symToStringTag","nativeObjectToString","_ponyfill","global","require$$0","index","$$observable","ADD_KEY","BACKSPACE","ADD_B","SET_LOCATION","SET_ORIGIN","S_C_A_KEY","SET_WIDTH","SET_HEIGHT","AUTO_LINEFEED","whereAmI","words","location","x","loc","length","y","nodeTypes","rowNum","word","i","w","canvas","document","createElement","ctx","getContext","fontSize","fontWeight","fontFamily","font","getFontWidth","text","size","weight","family","save","measureText","width","restore","setData","self","state","editorState","stringify","styleObject","str","keys","forEach","key","mathTag","Identifier","arg","ident","constructor","header","end","Style","style","name","init","Placeholder","attrs","value","height","match","_w","_h","Text","real","Space","Tab","Enter","Group","MathTag","Object","assign","nodeStyle","action","origin","type","constants","splice","a","b","c","createEndIdentifier","initEditorState","shiftKey","ctrlKey","altKey","app","_editorState","createStore","render","event","$emit","autoLinefeed","addKey","backspace","addB","setLocation","setOrigin","scaKey","setWidth","setHeight","tree","unsubscribe","store","subscribe","getState","updateWordsProps","last","undefined","addWord","dispatch","addMath","start","class","addEnter","moveUp","n","moveDown","moveLeft","moveRight","delBackspace","renderContent","h","_children","_words","len","call","children","domProps","innerHTML","_scopeId","hheadAscent","Math","floor","lineHeight","m","head","slice","arr","unshift","push","code","target","rowsIndex","isProcess","preventDefault","selectionStart","selectionEnd","el","s","$refs","back","focus","map","join","sp","visibility","position","top","left","body","appendChild","offsetHeight","data","log","editorFocus","clickingTools","keydown","oninput","isFocused","offsetY","color","submit"],"mappings":";;;AAAA;AACA,IAAI,UAAU,GAAG,OAAO,MAAM,IAAI,QAAQ,IAAI,MAAM,IAAI,MAAM,CAAC,MAAM,KAAK,MAAM,IAAI,MAAM;;ACC1F;AACA,IAAI,QAAQ,GAAG,OAAO,IAAI,IAAI,QAAQ,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM,KAAK,MAAM,IAAI,IAAI,CAAC;;;AAGjF,IAAI,IAAI,GAAG,UAAU,IAAI,QAAQ,IAAI,QAAQ,CAAC,aAAa,CAAC,EAAE;;ACJ9D;AACA,IAAIA,QAAM,GAAG,IAAI,CAAC,MAAM;;ACDxB;AACA,IAAIC,aAAW,GAAG,MAAM,CAAC,SAAS,CAAC;;;AAGnC,IAAIC,gBAAc,GAAGD,aAAW,CAAC,cAAc,CAAC;;;;;;;AAOhD,IAAI,oBAAoB,GAAGA,aAAW,CAAC,QAAQ,CAAC;;;AAGhD,IAAIE,gBAAc,GAAGH,QAAM,GAAGA,QAAM,CAAC,WAAW,GAAG,SAAS,CAAC;;;;;;;;;AAS7D,SAAS,SAAS,CAAC,KAAK,EAAE;EACxB,IAAI,KAAK,GAAGE,gBAAc,CAAC,IAAI,CAAC,KAAK,EAAEC,gBAAc,CAAC;MAClD,GAAG,GAAG,KAAK,CAACA,gBAAc,CAAC,CAAC;;EAEhC,IAAI;IACF,KAAK,CAACA,gBAAc,CAAC,GAAG,SAAS,CAAC;IAClC,IAAI,QAAQ,GAAG,IAAI,CAAC;GACrB,CAAC,OAAO,CAAC,EAAE,EAAE;;EAEd,IAAI,MAAM,GAAG,oBAAoB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;EAC9C,IAAI,QAAQ,EAAE;IACZ,IAAI,KAAK,EAAE;MACT,KAAK,CAACA,gBAAc,CAAC,GAAG,GAAG,CAAC;KAC7B,MAAM;MACL,OAAO,KAAK,CAACA,gBAAc,CAAC,CAAC;KAC9B;GACF;EACD,OAAO,MAAM,CAAC;CACf;;AC3CD;AACA,IAAIF,aAAW,GAAG,MAAM,CAAC,SAAS,CAAC;;;;;;;AAOnC,IAAIG,sBAAoB,GAAGH,aAAW,CAAC,QAAQ,CAAC;;;;;;;;;AAShD,SAAS,cAAc,CAAC,KAAK,EAAE;EAC7B,OAAOG,sBAAoB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;CACzC;;ACfD;AACA,IAAI,OAAO,GAAG,eAAe;IACzB,YAAY,GAAG,oBAAoB,CAAC;;;AAGxC,IAAI,cAAc,GAAGJ,QAAM,GAAGA,QAAM,CAAC,WAAW,GAAG,SAAS,CAAC;;;;;;;;;AAS7D,SAAS,UAAU,CAAC,KAAK,EAAE;EACzB,IAAI,KAAK,IAAI,IAAI,EAAE;IACjB,OAAO,KAAK,KAAK,SAAS,GAAG,YAAY,GAAG,OAAO,CAAC;GACrD;EACD,OAAO,CAAC,cAAc,IAAI,cAAc,IAAI,MAAM,CAAC,KAAK,CAAC;MACrD,SAAS,CAAC,KAAK,CAAC;MAChB,cAAc,CAAC,KAAK,CAAC,CAAC;CAC3B;;ACzBD;;;;;;;;AAQA,SAAS,OAAO,CAAC,IAAI,EAAE,SAAS,EAAE;EAChC,OAAO,SAAS,GAAG,EAAE;IACnB,OAAO,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;GAC7B,CAAC;CACH;;ACVD;AACA,IAAI,YAAY,GAAG,OAAO,CAAC,MAAM,CAAC,cAAc,EAAE,MAAM,CAAC;;ACHzD;;;;;;;;;;;;;;;;;;;;;;;;AAwBA,SAAS,YAAY,CAAC,KAAK,EAAE;EAC3B,OAAO,KAAK,IAAI,IAAI,IAAI,OAAO,KAAK,IAAI,QAAQ,CAAC;CAClD;;ACtBD;AACA,IAAI,SAAS,GAAG,iBAAiB,CAAC;;;AAGlC,IAAI,SAAS,GAAG,QAAQ,CAAC,SAAS;IAC9B,WAAW,GAAG,MAAM,CAAC,SAAS,CAAC;;;AAGnC,IAAI,YAAY,GAAG,SAAS,CAAC,QAAQ,CAAC;;;AAGtC,IAAI,cAAc,GAAG,WAAW,CAAC,cAAc,CAAC;;;AAGhD,IAAI,gBAAgB,GAAG,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BjD,SAAS,aAAa,CAAC,KAAK,EAAE;EAC5B,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,UAAU,CAAC,KAAK,CAAC,IAAI,SAAS,EAAE;IAC1D,OAAO,KAAK,CAAC;GACd;EACD,IAAI,KAAK,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC;EAChC,IAAI,KAAK,KAAK,IAAI,EAAE;IAClB,OAAO,IAAI,CAAC;GACb;EACD,IAAI,IAAI,GAAG,cAAc,CAAC,IAAI,CAAC,KAAK,EAAE,aAAa,CAAC,IAAI,KAAK,CAAC,WAAW,CAAC;EAC1E,OAAO,OAAO,IAAI,IAAI,UAAU,IAAI,IAAI,YAAY,IAAI;IACtD,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,gBAAgB,CAAC;CAC/C;;;;;;;;;;;;;AC3DD,YAAY,CAAC;;AAEb,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE;CAC5C,KAAK,EAAE,IAAI;CACX,CAAC,CAAC;AACH,OAAO,CAAC,SAAS,CAAC,GAAG,wBAAwB,CAAC;AAC9C,SAAS,wBAAwB,CAAC,IAAI,EAAE;CACvC,IAAI,MAAM,CAAC;CACX,IAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC;;CAE1B,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE;EAClC,IAAI,OAAO,CAAC,UAAU,EAAE;GACvB,MAAM,GAAG,OAAO,CAAC,UAAU,CAAC;GAC5B,MAAM;GACN,MAAM,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;GAC/B,OAAO,CAAC,UAAU,GAAG,MAAM,CAAC;GAC5B;EACD,MAAM;EACN,MAAM,GAAG,cAAc,CAAC;EACxB;;CAED,OAAO,MAAM,CAAC;CACd;;;;ACtBD,YAAY,CAAC;;AAEb,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE;EAC3C,KAAK,EAAE,IAAI;CACZ,CAAC,CAAC;;;;AAIH,IAAI,UAAU,GAAG,sBAAsB,CAACK,QAAS,CAAC,CAAC;;AAEnD,SAAS,sBAAsB,CAAC,GAAG,EAAE,EAAE,OAAO,GAAG,IAAI,GAAG,CAAC,UAAU,GAAG,GAAG,GAAG,EAAE,SAAS,EAAE,GAAG,EAAE,CAAC,EAAE;;AAEjG,IAAI,IAAI,CAAC;;;AAGT,IAAI,OAAO,IAAI,KAAK,WAAW,EAAE;EAC/B,IAAI,GAAG,IAAI,CAAC;CACb,MAAM,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;EACxC,IAAI,GAAG,MAAM,CAAC;CACf,MAAM,IAAI,OAAOC,cAAM,KAAK,WAAW,EAAE;EACxC,IAAI,GAAGA,cAAM,CAAC;CACf,MAAM,AAAmC;EACxC,IAAI,GAAG,MAAM,CAAC;CACf,AAEA;;AAED,IAAI,MAAM,GAAG,CAAC,CAAC,EAAE,UAAU,CAAC,SAAS,CAAC,EAAE,IAAI,CAAC,CAAC;AAC9C,OAAO,CAAC,SAAS,CAAC,GAAG,MAAM;;;AC5B3B,SAAc,GAAGC,OAAsB;;ACGvC;;;;;;AAMA,AAAO,IAAI,WAAW,GAAG;EACvB,IAAI,EAAE,cAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;CA2BrB,CAAgB,SAAS,WAAW,CAAC,OAAO,EAAE,cAAc,EAAE,QAAQ,EAAE;EACvE,IAAI,KAAK,CAAC;;EAEV,IAAI,OAAO,cAAc,KAAK,UAAU,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;IAC3E,QAAQ,GAAG,cAAc,CAAC;IAC1B,cAAc,GAAG,SAAS,CAAC;GAC5B;;EAED,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE;IACnC,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;MAClC,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;KAC5D;;IAED,OAAO,QAAQ,CAAC,WAAW,CAAC,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;GACvD;;EAED,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE;IACjC,MAAM,IAAI,KAAK,CAAC,wCAAwC,CAAC,CAAC;GAC3D;;EAED,IAAI,cAAc,GAAG,OAAO,CAAC;EAC7B,IAAI,YAAY,GAAG,cAAc,CAAC;EAClC,IAAI,gBAAgB,GAAG,EAAE,CAAC;EAC1B,IAAI,aAAa,GAAG,gBAAgB,CAAC;EACrC,IAAI,aAAa,GAAG,KAAK,CAAC;;EAE1B,SAAS,4BAA4B,GAAG;IACtC,IAAI,aAAa,KAAK,gBAAgB,EAAE;MACtC,aAAa,GAAG,gBAAgB,CAAC,KAAK,EAAE,CAAC;KAC1C;GACF;;;;;;;EAOD,SAAS,QAAQ,GAAG;IAClB,OAAO,YAAY,CAAC;GACrB;;;;;;;;;;;;;;;;;;;;;;;;;EAyBD,SAAS,SAAS,CAAC,QAAQ,EAAE;IAC3B,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;MAClC,MAAM,IAAI,KAAK,CAAC,qCAAqC,CAAC,CAAC;KACxD;;IAED,IAAI,YAAY,GAAG,IAAI,CAAC;;IAExB,4BAA4B,EAAE,CAAC;IAC/B,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;;IAE7B,OAAO,SAAS,WAAW,GAAG;MAC5B,IAAI,CAAC,YAAY,EAAE;QACjB,OAAO;OACR;;MAED,YAAY,GAAG,KAAK,CAAC;;MAErB,4BAA4B,EAAE,CAAC;MAC/B,IAAIC,QAAK,GAAG,aAAa,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;MAC5C,aAAa,CAAC,MAAM,CAACA,QAAK,EAAE,CAAC,CAAC,CAAC;KAChC,CAAC;GACH;;;;;;;;;;;;;;;;;;;;;;;;;;;EA2BD,SAAS,QAAQ,CAAC,MAAM,EAAE;IACxB,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE;MAC1B,MAAM,IAAI,KAAK,CAAC,iCAAiC,GAAG,0CAA0C,CAAC,CAAC;KACjG;;IAED,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,WAAW,EAAE;MACtC,MAAM,IAAI,KAAK,CAAC,qDAAqD,GAAG,iCAAiC,CAAC,CAAC;KAC5G;;IAED,IAAI,aAAa,EAAE;MACjB,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;KACvD;;IAED,IAAI;MACF,aAAa,GAAG,IAAI,CAAC;MACrB,YAAY,GAAG,cAAc,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;KACrD,SAAS;MACR,aAAa,GAAG,KAAK,CAAC;KACvB;;IAED,IAAI,SAAS,GAAG,gBAAgB,GAAG,aAAa,CAAC;IACjD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MACzC,IAAI,QAAQ,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;MAC5B,QAAQ,EAAE,CAAC;KACZ;;IAED,OAAO,MAAM,CAAC;GACf;;;;;;;;;;;;EAYD,SAAS,cAAc,CAAC,WAAW,EAAE;IACnC,IAAI,OAAO,WAAW,KAAK,UAAU,EAAE;MACrC,MAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC,CAAC;KAC/D;;IAED,cAAc,GAAG,WAAW,CAAC;IAC7B,QAAQ,CAAC,EAAE,IAAI,EAAE,WAAW,CAAC,IAAI,EAAE,CAAC,CAAC;GACtC;;;;;;;;EAQD,SAAS,UAAU,GAAG;IACpB,IAAI,IAAI,CAAC;;IAET,IAAI,cAAc,GAAG,SAAS,CAAC;IAC/B,OAAO,IAAI,GAAG;;;;;;;;;MASZ,SAAS,EAAE,SAAS,SAAS,CAAC,QAAQ,EAAE;QACtC,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;UAChC,MAAM,IAAI,SAAS,CAAC,wCAAwC,CAAC,CAAC;SAC/D;;QAED,SAAS,YAAY,GAAG;UACtB,IAAI,QAAQ,CAAC,IAAI,EAAE;YACjB,QAAQ,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;WAC3B;SACF;;QAED,YAAY,EAAE,CAAC;QACf,IAAI,WAAW,GAAG,cAAc,CAAC,YAAY,CAAC,CAAC;QAC/C,OAAO,EAAE,WAAW,EAAE,WAAW,EAAE,CAAC;OACrC;KACF,EAAE,IAAI,CAACC,KAAY,CAAC,GAAG,YAAY;MAClC,OAAO,IAAI,CAAC;KACb,EAAE,IAAI,CAAC;GACT;;;;;EAKD,QAAQ,CAAC,EAAE,IAAI,EAAE,WAAW,CAAC,IAAI,EAAE,CAAC,CAAC;;EAErC,OAAO,KAAK,GAAG;IACb,QAAQ,EAAE,QAAQ;IAClB,SAAS,EAAE,SAAS;IACpB,QAAQ,EAAE,QAAQ;IAClB,cAAc,EAAE,cAAc;GAC/B,EAAE,KAAK,CAACA,KAAY,CAAC,GAAG,UAAU,EAAE,KAAK,CAAC;;;ACtP7C;;;;;;AAMA,AAAe,SAAS,OAAO,CAAC,OAAO,EAAE;;EAEvC,IAAI,OAAO,OAAO,KAAK,WAAW,IAAI,OAAO,OAAO,CAAC,KAAK,KAAK,UAAU,EAAE;IACzE,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;GACxB;;EAED,IAAI;;;;IAIF,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;;GAE1B,CAAC,OAAO,CAAC,EAAE,EAAE;;;;AClBhB;;;;;;;;;GASG;;ACFH;;;;AAIA,SAAS,SAAS,GAAG,EAAE;;AAEvB,IAAI,aAAoB,KAAK,YAAY,IAAI,OAAO,SAAS,CAAC,IAAI,KAAK,QAAQ,IAAI,SAAS,CAAC,IAAI,KAAK,WAAW,EAAE;EACjH,OAAO,CAAC,gFAAgF,GAAG,uEAAuE,GAAG,oFAAoF,GAAG,4EAA4E,GAAG,gEAAgE,CAAC,CAAC;CAC9Y;;ACfM,IAAMC,UAAU,SAAhB;AACP,AAAO,IAAMC,YAAY,WAAlB;;AAEP;;AAEA,AAAO,IAAMC,QAAQ,OAAd;;ACLA,IAAMC,eAAe,cAArB;AACP,AAAO,IAAMC,aAAa,YAAnB;;AAEP;AACA;AACA;AACA;AACA;AACA,AAAO,IAAMC,YAAY,WAAlB;;AAEP,AAAO,IAAMC,YAAY,WAAlB;AACP,AAAO,IAAMC,aAAa,YAAnB;;AAEP,AAAO,IAAMC,gBAAgB,eAAtB;;ACXP,SAASC,QAAT,CAAkBC,KAAlB,EAAyBC,QAAzB,EAAkC;MAC5BC,IAAI,CAAR;MACIC,MAAMF,QAAV;;MAEGD,MAAMI,MAAN,IAAgB,CAAnB,EAAqB;WACZ,EAACF,GAAE,CAAH,EAAMG,GAAE,CAAR,EAAP;GADF,MAEM,IAAGF,OAAOH,MAAMI,MAAhB,EAAuB;;;;QAGxBJ,MAAMG,GAAN,aAAsBG,OAAzB,EAAyC;aAChC,EAACJ,GAAE,CAAH,EAAMG,GAAEL,MAAMG,GAAN,EAAWI,MAAX,GAAkB,CAA1B,EAAP;;;;MAIEC,OAAOR,MAAMG,GAAN,CAAb;MACME,IAAIG,KAAKD,MAAf;OACI,IAAIE,IAAEN,GAAV,EAAcM,KAAG,CAAjB,EAAmBA,GAAnB,EAAuB;QACfC,IAAIV,MAAMS,CAAN,CAAV;QACGC,EAAEH,MAAF,IAAYC,KAAKD,MAApB,EAA2B;;KAA3B,MAEK;;;;;;SAMA,EAACL,IAAD,EAAIG,IAAJ,EAAP;;;AAGF,IAAMM,SAASC,SAASC,aAAT,CAAuB,QAAvB,CAAf;AACA,IAAMC,MAAMH,OAAOI,UAAP,CAAkB,IAAlB,CAAZ;;AAEA,IAAMC,WAAW,MAAjB;AACA,IAAMC,aAAa,QAAnB;AACA,IAAMC,aAAa,iBAAnB;;AAEAJ,IAAIK,IAAJ,GAAcH,QAAd,SAA0BC,UAA1B,SAAwCC,UAAxC;;AAEA,SAASE,YAAT,GAAmF;MAA7DC,IAA6D,uEAAxD,EAAwD;MAApDC,IAAoD,uEAA/CN,QAA+C;MAArCO,MAAqC,uEAA9BN,UAA8B;MAAlBO,MAAkB,uEAAXN,UAAW;;MAC7EO,IAAJ;MACIN,IAAJ,GAAcG,IAAd,SAAsBC,MAAtB,SAAgCC,MAAhC;MACId,IAAII,IAAIY,WAAJ,CAAgBL,IAAhB,EAAsBM,KAA9B;MACIC,OAAJ;SACOlB,CAAP;;;AAGF,SAASmB,OAAT,CAAiBC,IAAjB,EAAuBC,KAAvB,EAA6B;OACtBA,KAAL,GAAaA,MAAMC,WAAnB;OACKhC,KAAL,GAAa+B,MAAM/B,KAAnB;;;AAGF,SAASiC,SAAT,CAAmBC,WAAnB,EAA+B;MACzBC,MAAM,EAAV;SACOC,IAAP,CAAYF,WAAZ,EAAyBG,OAAzB,CAAiC,eAAO;WAC5BC,GAAV,SAAiBJ,YAAYI,GAAZ,CAAjB;GADF;SAGOH,GAAP;;;AC1DK,IAAMI,UAAU;WACZ,cADY;SAEd,SAFc;cAGT,SAHS;mBAIJ,OAJI;gBAKP;CALT;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICGDC;wBACU;;;;;;0CAGc;wCAAJC,GAAI;WAAA;;;UACpBC,2CAAY,KAAKC,WAAjB,gBAAgCF,GAAhC,KAAN;YACMG,MAAN,GAAe,IAAf;WACKC,GAAL,GAAWH,KAAX;aACOA,KAAP;;;;;;IAGEI;;;mBACkB;QAATC,KAAS,uEAAH,EAAG;;;;;UAEfC,IAAL,GAAY,MAAZ;UACKD,KAAL,GAAaA,KAAb;UACKE,IAAL;;;;;;2BAEK;WACAtB,KAAL,GAAa,KAAKoB,KAAL,CAAWpB,KAAX,IAAoB,CAAjC;;;;4BAEOA,OAAM;WACRA,KAAL,GAAaA,KAAb;;;;EAXgBa;;IAedU;;;uBACSF,IAAb,EAA6C;QAA1BG,KAA0B,uEAApB,EAAoB;QAAhBJ,KAAgB,uEAAV,EAAU;QAANK,KAAM;;;;;WAGtCJ,IAAL,GAAYA,IAAZ;WACKG,KAAL,GAAaA,KAAb;WACKJ,KAAL,GAAaA,KAAb;WACKK,KAAL,GAAaA,KAAb;;WAEKH,IAAL;;;;;;2BAEK;mBACmB,KAAKF,KADxB;UACEpB,KADF,UACEA,KADF;UACS0B,MADT,UACSA,MADT;;WAEA1B,KAAL,GAAa,CAAb;WACK0B,MAAL,GAAc,CAAd;UACG1B,KAAH,EAAS;aACFA,KAAL,GAAa,CAACA,MAAM2B,KAAN,CAAY,KAAZ,EAAmB,CAAnB,CAAD,IAA0B,CAAvC;;UAECD,MAAH,EAAU;aACHA,MAAL,GAAc,CAACA,OAAOC,KAAP,CAAa,KAAb,EAAoB,CAApB,CAAD,IAA2B,CAAzC;;WAEGC,EAAL,GAAU,KAAK5B,KAAf;WACK6B,EAAL,GAAU,KAAKH,MAAf;;;;4BAEO1B,OAAM;WACRA,KAAL,GAAaA,KAAb;;;;EAzBsBa;;IA6BpBiB;;;gBACSL,KAAb,EAAmB;;;;;WAEZJ,IAAL,GAAY,MAAZ;WACKI,KAAL,GAAaA,KAAb;WACKM,IAAL,GAAYN,KAAZ;WACKzB,KAAL,GAAa,CAAb;;;;;;+BAES;;;EARMuB;;IAabS;;;mBACU;;;;;WAGPP,KAAL,GAAa,OAAb;WACKM,IAAL,GAAY,MAAZ;;;;;EALgBD;;IASdG;;;iBACU;;;;;WAGPR,KAAL,GAAa,sBAAb;WACKM,IAAL,GAAY,kBAAZ;;;;;EALcD;;IASZI;;;mBACU;;;;;WAEPb,IAAL,GAAY,IAAZ;WACKI,KAAL,GAAa,MAAb;WACKM,IAAL,GAAY,IAAZ;;;;;EALgBD;;IASdK;;;mBACkB;QAATf,KAAS,uEAAH,EAAG;;;;;WAEfC,IAAL,GAAY,KAAZ;WACKD,KAAL,GAAaA,KAAb;WACKE,IAAL;;;;;;2BAEK;WACAtB,KAAL,GAAa,KAAKoB,KAAL,CAAWpB,KAAX,IAAoB,CAAjC;;;;4BAEOA,OAAM;WACRA,KAAL,GAAaA,KAAb;;;;EAXgBa;;IAeduB;;;qBACkB;QAATZ,KAAS,uEAAH,EAAG;;;;;WAEfH,IAAL,GAAY,MAAZ;WACKG,KAAL,GAAaA,KAAb;WACKJ,KAAL,GAAaiB,OAAOC,MAAP,CAAc,EAAd,EAAkBC,OAAlB,CAAb;;WAEKjB,IAAL;;;;;;;;;EAPkBa;;AC9Gf,SAAS9D,KAAT,GAA6C;MAA9B+B,KAA8B,uEAAxB,EAAwB;MAApBoC,MAAoB;MAAZnC,WAAY;MAC3C/B,QAD2C,GACvB+B,WADuB,CAC3C/B,QAD2C;MACjCmE,MADiC,GACvBpC,WADuB,CACjCoC,MADiC;;UAE3CD,OAAOE,IAAd;SACKC,OAAL;0CACcvC,KAAZ;YACMwC,MAAN,CAAatE,QAAb,EAAuB,CAAvB,EAA0BkE,OAAOf,KAAjC;aACOrB,KAAP;;SAEGuC,SAAL;;4CACcvC,KAAZ;cACMwC,MAAN,CAAatE,QAAb,EAAuB,CAAvB;eACO8B,KAAP;;;SAGGuC,KAAL;;YACME,IAAIJ,MAAR;YAAgBK,IAAIxE,QAApB;YACGuE,KAAKC,CAAR,EAAW,OAAO1C,KAAP;;YAERyC,IAAIC,CAAP,EAAS;cACHC,IAAID,CAAR;cACID,CAAJ;cACIE,CAAJ;;4CAEU3C,KAAZ;;YAEMrB,IAAI,IAAIoC,OAAJ,CAAU,EAAC,eAAe,MAAhB,EAAV,CAAV;cACMyB,MAAN,CAAaC,CAAb,EAAgB,CAAhB,EAAmB9D,CAAnB;cACM6D,MAAN,CAAaE,IAAE,CAAf,EAAkB,CAAlB,EAAqB/D,EAAEiE,mBAAF,EAArB;;eAEO5C,KAAP;;;;aAIOA,KAAP;;;;AClCJ,IAAM6C,kBAAkB;YACZ,CADY;UAEd,CAFc;aAGX,EAHW;YAIZ,KAJY;WAKb,KALa;UAMd,KANc;gBAOR;CAPhB;AASA,AAAO,SAAS5C,WAAT,GAAmD;MAA9BD,KAA8B,uEAAxB6C,eAAwB;MAAPT,MAAO;;UACjDA,OAAOE,IAAd;;SAEOC,YAAL;aACSN,OAAOC,MAAP,CAAc,EAAd,EAAkBlC,KAAlB,EAAyB;kBACpBoC,OAAOf;OADZ,CAAP;;SAIGkB,UAAL;aACSN,OAAOC,MAAP,CAAc,EAAd,EAAkBlC,KAAlB,EAAyB;gBACtBoC,OAAOf;OADV,CAAP;;SAIGkB,SAAL;;4BACsCH,OAAOf,KADnB;YACjByB,QADiB,iBACjBA,QADiB;YACPC,OADO,iBACPA,OADO;YACEC,MADF,iBACEA,MADF;;eAEjBf,OAAOC,MAAP,CAAc,EAAd,EAAkBlC,KAAlB,EAAyB;4BAAA,EACpB+C,gBADoB,EACXC;SADd,CAAP;;;SAKGT,SAAL;aACSN,OAAOC,MAAP,CAAc,EAAd,EAAkBlC,KAAlB,EAAyB;eACvBoC,OAAOf;OADT,CAAP;;SAIGkB,UAAL;aACSN,OAAOC,MAAP,CAAc,EAAd,EAAkBlC,KAAlB,EAAyB;gBACtBoC,OAAOf;OADV,CAAP;;SAIGkB,aAAL;aACSN,OAAOC,MAAP,CAAc,EAAd,EAAkBlC,KAAlB,EAAyB;sBAChBoC,OAAOf;OADhB,CAAP;;;aAKOrB,KAAP;;;;AC1CN,SAASiD,GAAT,GAA8B;MAAjBjD,KAAiB,uEAAX,EAAW;MAAPoC,MAAO;;MACtBc,eAAejD,YAAYD,MAAMC,WAAlB,EAA+BmC,MAA/B,CAArB;;SAEO;iBACQc,YADR;WAEGjF,MAAM+B,MAAM/B,KAAZ,EAAmBmE,MAAnB,EAA2Bc,YAA3B;GAFV;;;AAMF,YAAeC,YAAYF,GAAZ,CAAf;;ACLA,cAAe,EAACG;;GAAD,qBAAA,6BAAA;MAAA,kBACN;WACC;oBACU;KADhB;GAFW;;WAMJ;gBAAA,wBACOC,KADP,EACa;WACbC,KAAL,CAAW,eAAX,EAA4B,MAA5B;KAFK;wBAAA,gCAIeD,KAJf,EAIqB;WACrBC,KAAL,CAAW,eAAX,EAA4B,cAA5B,EAA4C,KAAKC,YAAjD;WACKA,YAAL,GAAoB,CAAC,KAAKA,YAA1B;KANK;gBAAA,wBAQOF,KARP,EAQa;WACbC,KAAL,CAAW,eAAX,EAA4B,MAA5B;;;CAfN;;ACRA,SAASE,MAAT,CAAgB/E,IAAhB,EAAqB;SACZ,EAAC6D,MAAMC,OAAP,EAA0BlB,OAAO5C,IAAjC,EAAP;;AAEF,SAASgF,SAAT,GAAoB;SACX,EAACnB,MAAMC,SAAP,EAAP;;AAEF,SAASmB,IAAT,GAAe;SACN,EAACpB,MAAMC,KAAP,EAAP;;;ACKF,SAASoB,WAAT,CAAsBzF,QAAtB,EAA+B;SACtB,EAACoE,MAAMC,YAAP,EAA+BlB,OAAOnD,QAAtC,EAAP;;AAEF,SAAS0F,SAAT,CAAoB1F,QAApB,EAA6B;SACpB,EAACoE,MAAMC,UAAP,EAA6BlB,OAAOnD,QAApC,EAAP;;AAEF,SAAS2F,MAAT,CAAiBf,QAAjB,EAA2BC,OAA3B,EAAoCC,MAApC,EAA2C;SAClC,EAACV,MAAMC,SAAP,EAA4BlB,OAAO,EAACyB,kBAAD,EAAWC,gBAAX,EAAoBC,cAApB,EAAnC,EAAP;;AAEF,SAASc,QAAT,CAAmBlE,KAAnB,EAAyB;SAChB,EAAC0C,MAAMC,SAAP,EAA4BlB,OAAOzB,KAAnC,EAAP;;AAEF,SAASmE,SAAT,CAAoBzC,MAApB,EAA2B;SAClB,EAACgB,MAAMC,UAAP,EAA6BlB,OAAOC,MAApC,EAAP;;;ICvBiBP,UAAwDxC;IAATuD,UAASvD;;;AAE3E,IAAIyF,SAAO,EAAX;;AAEA,IAAMC,gBAAcC,MAAMC,SAAN,CAAgB,YAAI;WAC/BD,MAAME,QAAN,EAAP;CADkB,CAApB;;AAIA,AAAO,SAASC,mBAAT,CAA2BnG,QAA3B,EAAoC;;MAEtC8F,OAAK/F,KAAL,CAAWI,MAAX,IAAqB,CAAxB,EAA0B;;;;SAIpBH,YAAY8F,OAAK/F,KAAL,CAAWI,MAA7B,EAAoC;QAC9BD,MAAMF,QAAV;QACIO,OAAOuF,OAAK/F,KAAL,CAAW,EAAEG,GAAb,CAAX;;QAEG,CAACK,IAAJ,EAAS;;;;;QAKLD,eAAJ;QACIc,OAAOb,KAAKkD,IAAL,IAAa,EAAxB;QACI/B,QAAQnB,KAAK+C,EAAL,IAAW,CAAvB;;WAEMpD,MAAM,CAAZ,EAAc;UACRkG,OAAON,OAAK/F,KAAL,CAAW,EAAEG,GAAb,CAAX;UACGkG,gBAAgBvD,OAAnB,EAAyB;;;UAGtBvC,UAAU+F,SAAb,EAAuB;iBACZD,KAAK9F,MAAd;;UAEC8F,KAAK9F,MAAL,IAAeA,MAAlB,EAAyB;;;UAGtB8F,gBAAgBxC,OAAnB,EAAyB;;;;cAIjBwC,KAAK3C,IAAL,IAAa,EAArB;eACS2C,KAAK9C,EAAL,IAAW,CAApB;;UAEGpD,MAAM,CAAT,EAAY;;SAETI,MAAL,GAAcA,UAAU,CAAxB;;aAESa,aAAaC,IAAb,CAAT;QACG0E,OAAK/F,KAAL,CAAWC,WAAS,CAApB,aAAkC4D,OAArC,EAA2C;cACjCzC,aAAaZ,KAAKkD,IAAlB,CAAR;KADF,MAEM,IAAGqC,OAAK/D,WAAL,CAAiBsD,YAAjB,IAAiC3D,QAAQoE,OAAK/D,WAAL,CAAiBL,KAA7D,EAAmE;cAC/DP,aAAaZ,KAAKkD,IAAlB,CAAR;WACKnD,MAAL;;SAEGoB,KAAL,GAAaA,KAAb;;;;;;ACnDJ,IAAIoE,OAAO,EAAX;;AAEA,IAAMC,cAAcC,MAAMC,SAAN,CAAgB,YAAI;SAC/BD,MAAME,QAAN,EAAP;CADkB,CAApB;;AAIA,AAAO,SAASI,OAAT,CAAkBjE,GAAlB,EAAsB;MACvB9B,aAAJ;MACG8B,OAAO,GAAV,EAAc;WACL,IAAIqB,OAAJ,EAAP;GADF,MAEM,IAAGrB,OAAO,KAAV,EAAgB;WACb,IAAIsB,KAAJ,EAAP;GADI,MAED;WACI,IAAIH,MAAJ,CAASnB,GAAT,CAAP;;QAEIkE,QAAN,CAAejB,OAAO/E,IAAP,CAAf;QACMgG,QAAN,CAAed,YAAYK,KAAK/D,WAAL,CAAiB/B,QAAjB,GAA0B,CAAtC,CAAf;QACMuG,QAAN,CAAeb,UAAUI,KAAK/D,WAAL,CAAiB/B,QAA3B,CAAf;;sBAEiB8F,KAAK/D,WAAL,CAAiB/B,QAAlC;;;AAGF;;AAQA,AAAO,SAASwG,OAAT,GAAmB;MAClBC,QAAQ,IAAI3C,SAAJ,CAAY,EAAC4C,OAAM,UAAP,EAAZ,CAAd;;QAEMH,QAAN,CAAejB,OAAO,IAAI9B,MAAJ,CAAS,GAAT,CAAP,CAAf;QACM+C,QAAN,CAAejB,OAAOmB,KAAP,CAAf;;QAEMF,QAAN,CAAed,YAAYK,KAAK/D,WAAL,CAAiB/B,QAAjB,GAA0B,CAAtC,CAAf;QACMuG,QAAN,CAAejB,OAAOmB,MAAM/B,mBAAN,EAAP,CAAf;QACM6B,QAAN,CAAejB,OAAO,IAAI9B,MAAJ,CAAS,GAAT,CAAP,CAAf;;QAEM+C,QAAN,CAAeb,UAAUI,KAAK/D,WAAL,CAAiB/B,QAA3B,CAAf;;sBAEiB8F,KAAK/D,WAAL,CAAiB/B,QAAjB,GAA0B,CAA3C;;;AAGF,AAAO,SAAS2G,QAAT,GAAoB;MACnBpG,OAAO,IAAIqD,OAAJ,EAAb;;QAEM2C,QAAN,CAAejB,OAAO/E,IAAP,CAAf;QACMgG,QAAN,CAAed,YAAYK,KAAK/D,WAAL,CAAiB/B,QAAjB,GAA0B,CAAtC,CAAf;QACMuG,QAAN,CAAeb,UAAUI,KAAK/D,WAAL,CAAiB/B,QAA3B,CAAf;sBACiB8F,KAAK/D,WAAL,CAAiB/B,QAAlC;;;ICvDiB6C,UAAwDxC;;;AAE3E,IAAIyF,SAAO,EAAX;;AAEA,IAAMC,gBAAcC,MAAMC,SAAN,CAAgB,YAAI;WAC/BD,MAAME,QAAN,EAAP;CADkB,CAApB;;AAKA,AAAO,SAASU,QAAT,GAAiB;MACnBd,OAAK/F,KAAL,CAAWI,MAAX,IAAqB,CAAxB,EAA2B;;kBAEdL,SAASgG,OAAK/F,KAAd,EAAqB+F,OAAK/D,WAAL,CAAiB/B,QAAtC,CAHS;MAGjBC,CAHiB,aAGjBA,CAHiB;MAGdG,CAHc,aAGdA,CAHc;;MAKlBF,MAAM4F,OAAK/D,WAAL,CAAiB/B,QAA3B;MACI6G,IAAI,CAAR;MACIrG,IAAIN,MAAM,CAAN,GAAUA,MAAI,CAAd,GAAkB,CAA1B;SACKM,KAAG,CAAR,EAAUA,GAAV,EAAc;QACTsF,OAAK/F,KAAL,CAAWS,CAAX,aAAyBqC,OAA5B,EAAkC;;;;QAI/BiD,OAAK/F,KAAL,CAAWS,CAAX,EAAcF,MAAd,GAAuBF,IAAE,CAA5B,EAA8B;;;;;QAK3B0F,OAAK/F,KAAL,CAAWS,CAAX,EAAcF,MAAd,IAAwBF,IAAE,CAA7B,EAA+B;;;;SAK1ByG,IAAI5G,CAAJ,GAAQA,CAAR,GAAY4G,IAAE,CAArB;QACM3G,MAAM,CAAN,GAAU,CAAV,GAAcA,GAApB;;QAEMqG,QAAN,CAAed,YAAYvF,GAAZ,CAAf;MACG,CAAC4F,OAAK/D,WAAL,CAAiB6C,QAArB,EAA8B;UACtB2B,QAAN,CAAeb,UAAUI,OAAK/D,WAAL,CAAiB/B,QAA3B,CAAf;;;AAGJ,AAAO,SAAS8G,UAAT,GAAmB;MACrBhB,OAAK/F,KAAL,CAAWI,MAAX,IAAqB,CAAxB,EAA2B;;mBAEdL,SAASgG,OAAK/F,KAAd,EAAqB+F,OAAK/D,WAAL,CAAiB/B,QAAtC,CAHW;MAGnBC,CAHmB,cAGnBA,CAHmB;MAGhBG,CAHgB,cAGhBA,CAHgB;;MAKpBF,MAAM4F,OAAK/D,WAAL,CAAiB/B,QAA3B;MACI6G,IAAI,CAAR;;MAEM1G,SAAS2F,OAAK/F,KAAL,CAAWI,MAA1B;MACIK,IAAIN,OAAOC,SAAO,CAAd,GAAkBA,MAAlB,GAA2BD,GAAnC;SACKM,IAAEL,MAAP,EAAcK,GAAd,EAAkB;QACbsF,OAAK/F,KAAL,CAAWS,CAAX,aAAyBqC,OAA5B,EAAkC;;;;QAI/BiD,OAAK/F,KAAL,CAAWS,CAAX,EAAcF,MAAd,GAAuBF,IAAE,CAA5B,EAA8B;;;;QAI3B0F,OAAK/F,KAAL,CAAWS,CAAX,EAAcF,MAAd,IAAwBF,IAAE,CAA7B,EAA+B;UAC1ByG,KAAK5G,CAAR,EAAU;;;;;;;QAORsG,QAAN,CAAed,YAAYvF,GAAZ,CAAf;;MAEG,CAAC4F,OAAK/D,WAAL,CAAiB6C,QAArB,EAA8B;UACtB2B,QAAN,CAAeb,UAAUI,OAAK/D,WAAL,CAAiB/B,QAA3B,CAAf;;;AAGJ,AAAO,SAAS+G,UAAT,GAAmB;SAClBjB,OAAK/D,WAAL,CAAiB/B,QAAjB,GAA4B,CAAlC,EAAoC;QAC5BC,IAAI6F,OAAK/D,WAAL,CAAiB/B,QAAjB,GAA0B,CAApC;QACMO,OAAOuF,OAAK/F,KAAL,CAAWE,CAAX,CAAb;;QAEGM,gBAAgBsC,OAAnB,EAAyB;YACjB0D,QAAN,CAAed,YAAYxF,CAAZ,CAAf;KADF,MAEK;YACGsG,QAAN,CAAed,YAAYxF,CAAZ,CAAf;UACG,CAAC6F,OAAK/D,WAAL,CAAiB6C,QAArB,EAA8B;cACtB2B,QAAN,CAAeb,UAAUI,OAAK/D,WAAL,CAAiB/B,QAA3B,CAAf;;;;;;AAMR,AAAO,SAASgH,WAAT,GAAoB;SACnBlB,OAAK/D,WAAL,CAAiB/B,QAAjB,GAA4B8F,OAAK/F,KAAL,CAAWI,MAA7C,EAAoD;QAC5CF,IAAI6F,OAAK/D,WAAL,CAAiB/B,QAAjB,GAA4B,CAAtC;QACIO,OAAOuF,OAAK/F,KAAL,CAAWE,CAAX,CAAX;QACGM,gBAAgBsC,OAAnB,EAAyB;YACjB0D,QAAN,CAAed,YAAYxF,CAAZ,CAAf;KADF,MAEK;YACGsG,QAAN,CAAed,YAAYxF,CAAZ,CAAf;UACG,CAAC6F,OAAK/D,WAAL,CAAiB6C,QAArB,EAA8B;cACtB2B,QAAN,CAAeb,UAAUI,OAAK/D,WAAL,CAAiB/B,QAA3B,CAAf;;;;;;;ICjGW6C,UAA+DxC;IAAxDwD,UAAwDxD;IAAjD4C,gBAAiD5C;;;AAElF,IAAIyF,SAAO,EAAX;;AAEA,IAAMC,gBAAcC,MAAMC,SAAN,CAAgB,YAAI;WAC/BD,MAAME,QAAN,EAAP;CADkB,CAApB;;AAIA,AAAO,SAASe,YAAT,GAAuB;SACtB,CAAN,EAAQ;QACDjH,QADC,GACW8F,OAAK/D,WADhB,CACD/B,QADC;;QAEHA,YAAY,CAAf,EAAkB;QACdO,OAAOuF,OAAK/F,KAAL,CAAWC,WAAS,CAApB,CAAX;;QAEGO,gBAAgB0C,aAAnB,EAA+B;;YAEvBsD,QAAN,CAAed,YAAYzF,WAAS,CAArB,CAAf;YACMuG,QAAN,CAAehB,WAAf;;UAEMa,OAAON,OAAK/F,KAAL,CAAW+F,OAAK/D,WAAL,CAAiB/B,QAAjB,GAA0B,CAArC,CAAb;UACG,CAACoG,IAAJ,EAAS;;;aAGFN,OAAK/F,KAAL,CAAW+F,OAAK/D,WAAL,CAAiB/B,QAA5B,CAAP;UACI,CAACO,gBAAgBsC,OAAhB,IAAyBtC,gBAAgBsD,OAA1C,KAAoDtD,KAAKoC,MAA7D,EAAoE;;YAC/DpC,KAAKoC,MAAL,KAAgByD,IAAnB,EAAwB;gBAChBG,QAAN,CAAehB,WAAf;gBACMgB,QAAN,CAAed,YAAYK,OAAK/D,WAAL,CAAiB/B,QAAjB,GAA0B,CAAtC,CAAf;gBACMuG,QAAN,CAAehB,WAAf;;YAECO,OAAK/F,KAAL,CAAW+F,OAAK/D,WAAL,CAAiB/B,QAAjB,GAA0B,CAArC,aAAmDiD,aAAtD,EAAkE;;;OANpE,MASK;;;KAnBP,MAsBK;YACGsD,QAAN,CAAed,YAAYK,OAAK/D,WAAL,CAAiB/B,QAAjB,GAA0B,CAAtC,CAAf;;;QAGEuG,QAAN,CAAeb,UAAUI,OAAK/D,WAAL,CAAiB/B,QAA3B,CAAf;;sBAEiB8F,OAAK/D,WAAL,CAAiB/B,QAAlC;;;ICjCiB6C,QAA+DxC;IAAxDwD,QAAwDxD;IAAjD4C,cAAiD5C;IAA3BmD,OAA2BnD;IAATuD,QAASvD;;;AAElF,SAAS6G,aAAT,CAAwBC,CAAxB,EAA2B3G,CAA3B,EAA6B;MACvB4G,YAAY,EAAhB;SACK5G,IAAE,KAAK6G,MAAL,CAAYlH,MAAnB,EAA0BK,GAA1B,EAA8B;QACxBC,IAAI,KAAK4G,MAAL,CAAY7G,CAAZ,CAAR;QACM8G,MAAMF,UAAUjH,MAAtB;QACGM,aAAaoC,KAAhB,EAAsB;UACjBpC,EAAEmC,GAAL,EAAS;kCACmBsE,cAAcK,IAAd,CAAmB,IAAnB,EAAyBJ,CAAzB,EAA4B3G,IAAE,CAA9B,CADnB;YACAgH,QADA,uBACAA,QADA;YACUrI,KADV,uBACUA,KADV;;YAED+D,QAAQ,EAACJ,OAAOrC,EAAEqC,KAAV,EAAd;kBACUwE,GAAV,IAAiBH,EAAE1G,EAAEsC,IAAJ,EAAWG,KAAX,EAAkBsE,QAAlB,CAAjB;YACIrI,KAAJ;OAJF,MAKK;eACI,EAACqI,UAASJ,SAAV,EAAqBjI,OAAOqB,CAA5B,EAAP;;KAPJ,MASM,IAAGC,aAAaoD,KAAhB,EAAsB;UACvBpD,EAAEmC,GAAL,EAAS;mCACmBsE,cAAcK,IAAd,CAAmB,IAAnB,EAAyBJ,CAAzB,EAA4B3G,IAAE,CAA9B,CADnB;YACAgH,UADA,wBACAA,QADA;YACUrI,MADV,wBACUA,KADV;;YAED+D,SAAQ,EAACJ,OAAOrC,EAAEqC,KAAV,EAAd;kBACUwE,GAAV,IAAiBH,EAAE1G,EAAEsC,IAAJ,EAAWG,MAAX,EAAkBsE,UAAlB,CAAjB;YACIrI,MAAJ;OAJF,MAKK;eACI,EAACqI,UAASJ,SAAV,EAAqBjI,OAAOqB,CAA5B,EAAP;;KAPE,MASA,IAAGC,aAAawC,WAAhB,EAA4B;UAC7BxC,aAAa+C,IAAhB,EAAqB;YAChB/C,EAAEiC,WAAF,CAAcK,IAAd,IAAsB,MAAzB,EAAgC;oBACpBuE,GAAV,IAAiB7G,EAAE0C,KAAnB;SADF,MAEK;oBACOmE,GAAV,IAAiBH,EAAE1G,EAAEsC,IAAJ,EAAU,EAAC0E,UAAS,EAACC,WAAUjH,EAAE0C,KAAb,EAAV,EAAV,CAAjB;;OAJJ,MAMK;YACGD,UAAQ,EAACA,OAAOzC,EAAEyC,KAAV,EAAiBJ,OAAOrC,EAAEqC,KAA1B,EAAd;kBACUwE,GAAV,IAAiBH,EAAE1G,EAAEsC,IAAJ,EAAUG,OAAV,EAAiBzC,EAAE0C,KAAnB,CAAjB;;;;SAICiE,SAAP;;;AAGF,UAAe,EAACO,2BAAD;QACP,QADO;SAEN,CAAC,OAAD,EAAU,QAAV,CAFM;MAAA,kBAGL;WACC;aACE,EADF;aAEE,EAFF;mBAGQ,CAHR;gBAIK,EAJL;YAKC,CALD;oBAMS,IANT;aAOEtB,SAPF;iBAQM,KARN;iBASM;KATb;GAJW;;YAgBH;cAAA,wBACK;aACJ,KAAKtF,QAAL,GAAgB,KAAK6G,WAA5B;KAFM;WAAA,qBAIE;UACFrD,IAAIsD,KAAKC,KAAL,CAAW,KAAK1E,MAAL,GAAc,KAAK2E,UAA9B,CAAV;UACMvD,IAAI,KAAKpE,CAAL,EAAV;UACM4H,IAAIxD,IAAI,KAAKyD,IAAnB;UACGD,KAAKzD,CAAR,EAAU;aACH0D,IAAL,IAAaD,IAAIzD,CAAJ,GAAQ,CAArB;OADF,MAEM,IAAGyD,IAAI,CAAP,EAAS;aACRC,IAAL,IAAaD,CAAb;;aAEK,CAAC,KAAKC,IAAN,GAAa,KAAKF,UAAzB;KAbM;UAAA,oBAeC;mBACoB,KAAKjG,KADzB;UACAqC,MADA,UACAA,MADA;UACQnE,QADR,UACQA,QADR;;;UAGJmE,UAAUnE,QAAb,EAAsB;eACb,KAAKD,KAAZ;;UAEEA,QAAQ,KAAKA,KAAL,CAAWmI,KAAX,EAAZ;;UAEI3D,IAAIJ,MAAR;UAAgBK,IAAIxE,QAApB;UACGuE,IAAIC,CAAP,EAAS;YACHC,IAAID,CAAR;YACID,CAAJ;YACIE,CAAJ;;UAEE0D,MAAM,KAAKpI,KAAL,CAAWmI,KAAX,CAAiB3D,CAAjB,EAAoBC,CAApB,CAAV;UACMiC,QAAQ,IAAI5D,KAAJ,CAAU;uBACP,KAAKkF,UAAL,GAAkB,IADX;oBAEV;OAFA,CAAd;;UAKIK,OAAJ,CAAY3B,KAAZ;UACI4B,IAAJ,CAAS5B,MAAM/B,mBAAN,EAAT;YACMJ,MAAN,eAAaC,CAAb,EAAgBC,IAAED,CAAlB,2BAAwB4D,GAAxB;;aAEOpI,KAAP;;GAvDS;WA0DJ;KAAA,eACH;;UACGC,QADH,GACe,KAAK8B,KADpB,CACG9B,QADH;;UAEII,IAAI,KAAKA,CAAL,EAAV;UACIsB,QAAQ,CAAZ;aACM,CAAN,EAAQ;YACH1B,YAAY,CAAf,EAAiB;;;YAGbO,OAAO,KAAKR,KAAL,CAAW,EAAEC,QAAb,CAAX;YACGO,KAAKD,MAAL,IAAeF,CAAlB,EAAoB;cACf,CAACG,KAAKmB,KAAT,EAAgB;kBACRnB,KAAKmB,KAAb;;;;aAIGA,QAAQ,CAAf;KAhBK;KAAA,eAkBH;UACK3B,KADL,GACc,IADd,CACKA,KADL;UAEGC,QAFH,GAEe,KAAK8B,KAFpB,CAEG9B,QAFH;;UAGEQ,IAAI,CAAR;aACMR,YAAY,CAAlB,EAAoB;YACfA,YAAY,CAAZ,IAAiB,CAACD,MAAMC,QAAN,CAArB,EAAsC;;iBAC7B,CAAP;;;YAGEO,OAAOR,MAAM,EAAEC,QAAR,CAAX;YACGO,gBAAgB0C,WAAnB,EAA+B;cACzB1C,KAAKD,MAAT;cACGC,gBAAgBqD,KAAnB,EAAyB;;;WAAzB,MAEM,IAAG7D,MAAMC,WAAS,CAAf,CAAH,EAAqB;gBACtBD,MAAMC,WAAS,CAAf,EAAkBM,MAAlB,GAA2BC,KAAKD,MAAnC,EAA0C;;;;;;;aAOzCE,CAAP;KAxCK;iBAAA,yBA2CQuC,IA3CR,EA2CqB;UACvBA,QAAQ,MAAX,EAAkB;YACb,KAAKjB,KAAL,CAAW9B,QAAX,IAAuB,KAAK8B,KAAL,CAAWqC,MAArC,EAA4C;;;cAGtCoC,QAAN,CAAef,MAAf;;cAEMe,QAAN,CAAed,YAAY,KAAK3D,KAAL,CAAW9B,QAAX,GAAoB,CAAhC,CAAf;cACMuG,QAAN,CAAeb,UAAU,KAAK5D,KAAL,CAAWqC,MAAX,GAAoB,CAA9B,CAAf;OAPF,MAQM,IAAGpB,QAAQ,MAAX,EAAkB;;;KApDnB;WAAA,mBAwDEoC,KAxDF,EAwDQ;UACR9C,GADQ,GACwC8C,KADxC,CACR9C,GADQ;UACHiG,IADG,GACwCnD,KADxC,CACHmD,IADG;UACG1D,QADH,GACwCO,KADxC,CACGP,QADH;UACaC,OADb,GACwCM,KADxC,CACaN,OADb;UACsBC,MADtB,GACwCK,KADxC,CACsBL,MADtB;UAC8ByD,MAD9B,GACwCpD,KADxC,CAC8BoD,MAD9B;UAERzG,KAFQ,GAEQ,IAFR,CAERA,KAFQ;UAED/B,KAFC,GAEQ,IAFR,CAEDA,KAFC;UAGRC,QAHQ,GAGe8B,KAHf,CAGR9B,QAHQ;UAGEwI,SAHF,GAGe1G,KAHf,CAGE0G,SAHF;;UAIVnG,OAAO,SAAV,EAAoB;aACboG,SAAL,GAAiB,KAAjB;cACMlC,QAAN,CAAeZ,OAAOf,QAAP,EAAiBC,OAAjB,EAA0BC,MAA1B,CAAf;;gBAEOwD,IAAP;eACO,SAAL;;;eAGK,WAAL;;;eAGK,WAAL;;;eAGK,YAAL;;;eAGK,WAAL;;;eAGK,aAAL,CAhBF;eAiBO,OAAL;;qBACWjG,GAAT;;eAEG,WAAL;eACK,aAAL;eACK,SAAL;eACK,YAAL;eACK,cAAL;eACK,UAAL;;;oBAGUA,GAAR;;cAEEqG,cAAN;OAlCF,MAmCK;aACED,SAAL,GAAiB,IAAjB;;;KAhGG;WAAA,mBAoGEtD,KApGF,EAoGQ;0BAC0BA,MAAMoD,MADhC;UACNI,cADM,iBACNA,cADM;UACUC,YADV,iBACUA,YADV;;;UAGV,KAAKH,SAAL,IAAkBE,kBAAkBC,YAAvC,EAAoD;YAC9CxH,mCAAW+D,MAAMoD,MAAN,CAAab,SAAxB,EAAJ;eACOmB,EAAP,GAAY1D,MAAMoD,MAAlB;;aAEKnG,OAAL,CAAa,aAAG;kBACN0G,CAAR;SADF;aAGKL,SAAL,GAAiB,KAAjB;;;KA9GG;eAAA,uBAmHMtD,KAnHN,EAmHY;WACZ4D,KAAL,CAAWC,IAAX,CAAgBC,KAAhB;KApHK;UAAA,kBAsHC9D,KAtHD,EAsHO;UACN/D,OAAO,KAAKrB,KAAL,CACVmJ,GADU,CACN,aAAK;YACLzI,aAAawC,WAAhB,EAA4B;iBACnBxC,EAAE0C,KAAT;SADF,MAEK;cACA1C,EAAEmC,GAAL,EAAS;;gBAEJnC,aAAaoC,KAAhB,EAAsB;2BACTpC,EAAEsC,IAAb,gBAA4BtC,EAAEyC,KAAF,CAAQwD,KAApC,iBAAqD1E,UAAUvB,EAAEqC,KAAZ,CAArD;aADF,MAEM,IAAIrC,aAAaoD,KAAjB,EAAuB;2BAChBpD,EAAEsC,IAAb,gBAA4BtC,EAAEyC,KAAF,CAAQwD,KAApC;;WALJ,MAQM,IAAGjG,EAAEkC,MAAL,EAAY;0BACJlC,EAAEsC,IAAd;;;OAdK,EAkBVoG,IAlBU,CAkBL,EAlBK,CAAb;;WAoBK/D,KAAL,CAAW,gBAAX,EAA6BhE,IAA7B;;GArMS;;SAAA,qBAyMH;;;QACF2E,cAAcC,MAAMC,SAAN,CAAgB,YAAI;qBACxBD,MAAME,QAAN,EAAd;KADkB,CAApB;UAGMK,QAAN,CAAed,YAAY,CAAZ,CAAf;UACMc,QAAN,CAAeX,SAAS,KAAKlE,KAAd,CAAf;UACM6E,QAAN,CAAeV,UAAU,KAAKzC,MAAf,CAAf;GA/MW;SAAA,qBAkNH;QACFgG,KAAKzI,SAASC,aAAT,CAAuB,MAAvB,CAAX;OACGkC,KAAH,CAAS/B,QAAT,GAAoB,QAApB;OACG+B,KAAH,CAASuG,UAAT,GAAsB,QAAtB;OACGvG,KAAH,CAASwG,QAAT,GAAoB,UAApB;OACGxG,KAAH,CAASyG,GAAT,GAAe,KAAf;OACGzG,KAAH,CAAS0G,IAAT,GAAgB,KAAhB;OACG9B,SAAH,GAAe,GAAf;aACS+B,IAAT,CAAcC,WAAd,CAA0BN,EAA1B;;SAEKxB,WAAL,GAAmBwB,GAAGO,YAAH,GAAkB,IAArC,CAVQ;GAlNG;QAAA,kBAgOLxC,CAhOK,EAgOH;;;QACFyC,OAAO1C,cAAcK,IAAd,CAAmB,IAAnB,EAAyBJ,CAAzB,EAA4B,CAA5B,CAAb;YACQ0C,GAAR,CAAY,KAAKxC,MAAL,CAAY6B,GAAZ,CAAgB;aAAKzI,EAAE0C,KAAF,GAAU1C,EAAE0C,KAAF,GAAQ,IAAR,GAAa1C,EAAEH,MAAf,GAAsB,GAAtB,GAA0BG,EAAEiB,KAAtC,GAA8C2E,SAAnD;KAAhB,CAAZ;;WAGE;;QAAK,SAAM,YAAX;mBAAiC,KAAKyD;;;OACpC;eAAA;;;6BAA0B,KAAKC;;;;OADjC,EAEE;;UAAK,SAAM,MAAX,EAAkB,OAAO,EAAC,SAAS,KAAKrI,KAAL,GAAW,IAArB,EAA2B,UAAU,KAAK0B,MAAL,GAAY,IAAjD,EAAzB;SACE;;;iBACM,MADN;qBAEQ,MAFR,WAEe,iBAAgB;;;yBAClB,KAAK4G,OAHlB;uBAIW,KAAKC,OAJhB;uBAKa;uBAAI,OAAKC,SAAL,GAAiB,IAArB;eALb;sBAMY;uBAAI,OAAKA,SAAL,GAAiB,KAArB;;;;;SAPd,EAUE;;YAAK,SAAO,CAAC,QAAD,EAAW,KAAKA,SAAL,GAAe,WAAf,GAA2B,EAAtC,CAAZ;mBACS;6BACU,KAAKnC,UAAL,GAAkB,IAD5B;qBAEE,KAAK9H,CAAL,KAAW,IAFb;qBAGE,KAAKG,CAAL,KAAW,KAAK2H,UAAhB,GAA6B,IAH/B;qBAIE,KAAKoC,OAAL,GAAe,IAJjB;4BAKS,KAAK9E,YAAL,GAAoB,WAApB,GAAkC;aANpD;WASIuE,KAAKzJ,MAAL,IAAe,KAAK+J,SAApB,GAAgC,EAAhC,GAAqC;;cAAM,OAAO,EAACE,OAAO,MAAR,EAAb;;WATzC,EAYIR,IAZJ;SAVF;OAFF,EA4BE;;;;qBAAiB,KAAKS;;;;OA5BxB;KADF;;CApOJ;;;;;;;;"}